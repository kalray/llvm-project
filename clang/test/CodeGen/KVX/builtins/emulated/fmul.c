// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py
// RUN: %clang_cc1 -triple kvx-kalray-cos -emit-llvm %s -O3 -o - | FileCheck %s

#include <kvx_builtins.h>

// CHECK-LABEL: @fmulho(
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[TMP0:%.*]] = bitcast <8 x i16> [[A:%.*]] to <8 x half>
// CHECK-NEXT:    [[TMP1:%.*]] = shufflevector <8 x half> [[TMP0]], <8 x half> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 3>
// CHECK-NEXT:    [[TMP2:%.*]] = bitcast <8 x i16> [[B:%.*]] to <8 x half>
// CHECK-NEXT:    [[TMP3:%.*]] = shufflevector <8 x half> [[TMP2]], <8 x half> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 3>
// CHECK-NEXT:    [[TMP4:%.*]] = tail call <4 x half> @llvm.kvx.fmul.v4f16(<4 x half> [[TMP1]], <4 x half> [[TMP3]], i32 1, i32 0)
// CHECK-NEXT:    [[TMP5:%.*]] = bitcast <8 x i16> [[A]] to <8 x half>
// CHECK-NEXT:    [[TMP6:%.*]] = shufflevector <8 x half> [[TMP5]], <8 x half> poison, <4 x i32> <i32 4, i32 5, i32 6, i32 7>
// CHECK-NEXT:    [[TMP7:%.*]] = bitcast <8 x i16> [[B]] to <8 x half>
// CHECK-NEXT:    [[TMP8:%.*]] = shufflevector <8 x half> [[TMP7]], <8 x half> poison, <4 x i32> <i32 4, i32 5, i32 6, i32 7>
// CHECK-NEXT:    [[TMP9:%.*]] = tail call <4 x half> @llvm.kvx.fmul.v4f16(<4 x half> [[TMP6]], <4 x half> [[TMP8]], i32 1, i32 0)
// CHECK-NEXT:    [[DOTUNCASTED:%.*]] = shufflevector <4 x half> [[TMP4]], <4 x half> [[TMP9]], <8 x i32> <i32 0, i32 1, i32 2, i32 3, i32 4, i32 5, i32 6, i32 7>
// CHECK-NEXT:    [[TMP10:%.*]] = bitcast <8 x half> [[DOTUNCASTED]] to <8 x i16>
// CHECK-NEXT:    ret <8 x i16> [[TMP10]]
//
__kvx_v8hi fmulho(__kvx_v8hi a, __kvx_v8hi b){
  return __builtin_kvx_fmulho(a, b, ".ru");
}

// CHECK-LABEL: @fmulhx(
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[TMP0:%.*]] = bitcast <16 x i16> [[A:%.*]] to <16 x half>
// CHECK-NEXT:    [[TMP1:%.*]] = shufflevector <16 x half> [[TMP0]], <16 x half> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 3>
// CHECK-NEXT:    [[TMP2:%.*]] = bitcast <16 x i16> [[B:%.*]] to <16 x half>
// CHECK-NEXT:    [[TMP3:%.*]] = shufflevector <16 x half> [[TMP2]], <16 x half> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 3>
// CHECK-NEXT:    [[TMP4:%.*]] = tail call <4 x half> @llvm.kvx.fmul.v4f16(<4 x half> [[TMP1]], <4 x half> [[TMP3]], i32 1, i32 0)
// CHECK-NEXT:    [[TMP5:%.*]] = bitcast <16 x i16> [[A]] to <16 x half>
// CHECK-NEXT:    [[TMP6:%.*]] = shufflevector <16 x half> [[TMP5]], <16 x half> poison, <4 x i32> <i32 4, i32 5, i32 6, i32 7>
// CHECK-NEXT:    [[TMP7:%.*]] = bitcast <16 x i16> [[B]] to <16 x half>
// CHECK-NEXT:    [[TMP8:%.*]] = shufflevector <16 x half> [[TMP7]], <16 x half> poison, <4 x i32> <i32 4, i32 5, i32 6, i32 7>
// CHECK-NEXT:    [[TMP9:%.*]] = tail call <4 x half> @llvm.kvx.fmul.v4f16(<4 x half> [[TMP6]], <4 x half> [[TMP8]], i32 1, i32 0)
// CHECK-NEXT:    [[SHUFFLE12:%.*]] = shufflevector <4 x half> [[TMP4]], <4 x half> [[TMP9]], <8 x i32> <i32 0, i32 1, i32 2, i32 3, i32 4, i32 5, i32 6, i32 7>
// CHECK-NEXT:    [[SHUFFLE13:%.*]] = shufflevector <16 x i16> [[A]], <16 x i16> poison, <8 x i32> <i32 8, i32 9, i32 10, i32 11, i32 12, i32 13, i32 14, i32 15>
// CHECK-NEXT:    [[TMP10:%.*]] = bitcast <8 x i16> [[SHUFFLE13]] to <8 x half>
// CHECK-NEXT:    [[TMP11:%.*]] = shufflevector <8 x half> [[TMP10]], <8 x half> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 3>
// CHECK-NEXT:    [[SHUFFLE16:%.*]] = shufflevector <16 x i16> [[B]], <16 x i16> poison, <8 x i32> <i32 8, i32 9, i32 10, i32 11, i32 12, i32 13, i32 14, i32 15>
// CHECK-NEXT:    [[TMP12:%.*]] = bitcast <8 x i16> [[SHUFFLE16]] to <8 x half>
// CHECK-NEXT:    [[TMP13:%.*]] = shufflevector <8 x half> [[TMP12]], <8 x half> poison, <4 x i32> <i32 0, i32 1, i32 2, i32 3>
// CHECK-NEXT:    [[TMP14:%.*]] = tail call <4 x half> @llvm.kvx.fmul.v4f16(<4 x half> [[TMP11]], <4 x half> [[TMP13]], i32 1, i32 0)
// CHECK-NEXT:    [[TMP15:%.*]] = bitcast <8 x i16> [[SHUFFLE13]] to <8 x half>
// CHECK-NEXT:    [[TMP16:%.*]] = shufflevector <8 x half> [[TMP15]], <8 x half> poison, <4 x i32> <i32 4, i32 5, i32 6, i32 7>
// CHECK-NEXT:    [[TMP17:%.*]] = bitcast <8 x i16> [[SHUFFLE16]] to <8 x half>
// CHECK-NEXT:    [[TMP18:%.*]] = shufflevector <8 x half> [[TMP17]], <8 x half> poison, <4 x i32> <i32 4, i32 5, i32 6, i32 7>
// CHECK-NEXT:    [[TMP19:%.*]] = tail call <4 x half> @llvm.kvx.fmul.v4f16(<4 x half> [[TMP16]], <4 x half> [[TMP18]], i32 1, i32 0)
// CHECK-NEXT:    [[SHUFFLE25:%.*]] = shufflevector <4 x half> [[TMP14]], <4 x half> [[TMP19]], <8 x i32> <i32 0, i32 1, i32 2, i32 3, i32 4, i32 5, i32 6, i32 7>
// CHECK-NEXT:    [[SHUFFLE26_UNCASTED:%.*]] = shufflevector <8 x half> [[SHUFFLE12]], <8 x half> [[SHUFFLE25]], <16 x i32> <i32 0, i32 1, i32 2, i32 3, i32 4, i32 5, i32 6, i32 7, i32 8, i32 9, i32 10, i32 11, i32 12, i32 13, i32 14, i32 15>
// CHECK-NEXT:    [[SHUFFLE26:%.*]] = bitcast <16 x half> [[SHUFFLE26_UNCASTED]] to <16 x i16>
// CHECK-NEXT:    ret <16 x i16> [[SHUFFLE26]]
//
__kvx_v16hi fmulhx(__kvx_v16hi a, __kvx_v16hi b){
  return __builtin_kvx_fmulhx(a, b, ".ru");
}
