// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py
// RUN: %clang -target kvx-kalray-cos -march=kv3-2 %s -O3 -S -o - -emit-llvm | FileCheck %s

#include "vector-types.h"

// CHECK-LABEL: @use_2k_buff(
// CHECK-NEXT:    [[TMP3:%.*]] = load <2048 x i1>, ptr [[TMP0:%.*]], align 32, !tbaa [[TBAA3:![0-9]+]]
// CHECK-NEXT:    [[TMP4:%.*]] = tail call <256 x i1> asm sideeffect "xaligno $0 = $1, $2", "=x,x,r,0"(<2048 x i1> [[TMP3]], i32 [[TMP1:%.*]], <256 x i1> undef) #[[ATTR2:[0-9]+]], !srcloc !7
// CHECK-NEXT:    ret void
//
void use_2k_buff(__kvx_x2048 *x, int c) {
  __kvx_x256 out;
  __asm__ volatile("xaligno %0 = %1, %2"
                   : "+x"(out)
                   : "x"(x[0]), "r"(c)
                   : );
}

// CHECK-LABEL: @use_4k_buff(
// CHECK-NEXT:    [[TMP3:%.*]] = load <4096 x i1>, ptr [[TMP0:%.*]], align 32, !tbaa [[TBAA8:![0-9]+]]
// CHECK-NEXT:    [[TMP4:%.*]] = tail call <256 x i1> asm sideeffect "xaligno $0 = $1, $2", "=x,x,r,0"(<4096 x i1> [[TMP3]], i32 [[TMP1:%.*]], <256 x i1> undef) #[[ATTR2]], !srcloc !10
// CHECK-NEXT:    ret void
//
void use_4k_buff(__kvx_x4096 *x, int c) {
  __kvx_x256 out;
  __asm__ volatile("xaligno %0 = %1, %2"
                   : "+x"(out)
                   : "x"(x[0]), "r"(c)
                   : );
}

// CHECK-LABEL: @use_2k_buff_clobber(
// CHECK-NEXT:    [[TMP3:%.*]] = load <4096 x i1>, ptr [[TMP0:%.*]], align 32, !tbaa [[TBAA8]]
// CHECK-NEXT:    [[TMP4:%.*]] = tail call <256 x i1> asm sideeffect "xaligno $0 = $1, $2", "=x,x,r,0,~{$a0..a7}"(<4096 x i1> [[TMP3]], i32 [[TMP1:%.*]], <256 x i1> undef) #[[ATTR2]], !srcloc !11
// CHECK-NEXT:    ret void
//
void use_2k_buff_clobber(__kvx_x4096 *x, int c) {
  __kvx_x256 out;
  __asm__ volatile("xaligno %0 = %1, %2"
                   : "+x"(out)
                   : "x"(x[0]), "r"(c)
                   : "$a0..a7");
}

// CHECK-LABEL: @use_4k_buff_clobber(
// CHECK-NEXT:    [[TMP3:%.*]] = load <4096 x i1>, ptr [[TMP0:%.*]], align 32, !tbaa [[TBAA8]]
// CHECK-NEXT:    [[TMP4:%.*]] = tail call <256 x i1> asm sideeffect "xaligno $0 = $1, $2", "=x,x,r,0,~{$a0..a15}"(<4096 x i1> [[TMP3]], i32 [[TMP1:%.*]], <256 x i1> undef) #[[ATTR2]], !srcloc !12
// CHECK-NEXT:    ret void
//
void use_4k_buff_clobber(__kvx_x4096 *x, int c) {
  __kvx_x256 out;
  __asm__ volatile("xaligno %0 = %1, %2"
                   : "+x"(out)
                   : "x"(x[0]), "r"(c)
                   : "$a0..a15");
}
