// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_udivv8hi3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef unsigned short elt;
typedef elt vt __attribute__((__vector_size__(16)));
vt __udivv8hi3(vt a, vt b);

int test__udivv8hi3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __udivv8hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __udivv8hi3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
    {{5597, 24572, 3157, 28522, 18916, 25748, 22681, 12083},
     {28636, 24415, 14616, 11591, 24003, 8527, 12920, 25454},
     {0, 1, 0, 2, 0, 3, 1, 0}},
    {{27689, 18867, 23446, 2721, 14936, 3605, 17866, 12801},
     {47266, 55840, 43048, 16938, 33030, 17058, 43199, 39737},
     {0, 0, 0, 0, 0, 0, 0, 0}},
    {{25868, 4181, 2693, 30822, 838, 5053, 12522, 5070},
     {64610, 19035, 57157, 25585, 43305, 42291, 46717, 65001},
     {0, 0, 0, 1, 0, 0, 0, 0}},
    {{23107, 7164, 24961, 13491, 21260, 30471, 16462, 22525},
     {13363, 38967, 10513, 46314, 58490, 63007, 51248, 30946},
     {1, 0, 2, 0, 0, 0, 0, 0}},
    {{4731, 14636, 10637, 31213, 11736, 13048, 3318, 31295},
     {45625, 57839, 38886, 51224, 22744, 18810, 53340, 62238},
     {0, 0, 0, 0, 0, 0, 0, 0}},
    {{31661, 25739, 26382, 18718, 9259, 31539, 18987, 14314},
     {57926, 22560, 39826, 10881, 46438, 38174, 1759, 17743},
     {0, 1, 0, 1, 0, 0, 10, 0}},
    {{24469, 2262, 1746, 25372, 23051, 3973, 9952, 2441},
     {14929, 34518, 63727, 17257, 51503, 43475, 29028, 35795},
     {1, 0, 0, 1, 0, 0, 0, 0}},
    {{10392, 17292, 14195, 7002, 23906, 44, 19208, 15644},
     {45725, 59491, 2376, 17741, 2350, 5619, 56950, 38777},
     {0, 0, 5, 0, 10, 0, 0, 0}},
    {{28105, 25851, 18959, 3259, 27146, 24483, 29764, 16781},
     {9173, 25475, 20938, 33268, 16032, 26928, 20255, 57976},
     {3, 1, 0, 0, 1, 0, 1, 0}},
    {{7294, 32746, 5215, 22792, 22988, 32315, 21253, 21458},
     {36835, 47814, 52726, 44135, 42248, 32149, 48542, 12190},
     {0, 0, 0, 0, 0, 1, 0, 1}},
    {{13760, 32156, 28471, 15205, 8088, 27677, 27630, 24134},
     {41166, 63437, 12890, 60439, 60886, 46699, 49696, 23063},
     {0, 0, 2, 0, 0, 0, 0, 1}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__udivv8hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
