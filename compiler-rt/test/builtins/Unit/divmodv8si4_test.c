// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_divmodv8si4

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef int elt;
typedef elt vt __attribute__((__vector_size__(32)));
vt __divmodv8si4(vt a, vt b, vt *r);

int test__divmodv8si4(vt a, vt b, vt expected_q, vt expected_rem) {
  const int N = sizeof(vt) / sizeof(elt);
  vt rem;
  vt q = __divmodv8si4(a, b, &rem);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected_q[lane] || rem[lane] != expected_rem[lane]) {
      printf("error in __divmodv8si4 (lane %d): %d divmod %d = q(%d), "
             "rem(%d), expected q(%d), rem (%d)\n",
             lane, a[lane], b[lane], q[lane], rem[lane], expected_q[lane],
             expected_rem[lane]);
      res = 1;
    }
  return res;
}

vt tests[][4] = {
{{-438350705, -727698365, 396004311, 1090515857, 1076654944, 578063529, 1293662684, 12667575}, {1196451267, 1447482302, 860822517, 751371755, 191238140, 1688189168, 312090319, 1516409980}, {0, 0, 0, 1, 5, 0, 4, 0}, {-438350705, -727698365, 396004311, 339144102, 120464244, 578063529, 45301408, 12667575}},
{{1558326570, -833471307, -110660990, 654583243, 195225966, 641363869, -153440588, -597280151}, {841282679, 466168260, 790816378, 679945946, 403804297, 1136941377, 361633808, -721956035}, {1, -1, 0, 0, 0, 0, 0, 0}, {717043891, -367303047, -110660990, 654583243, 195225966, 641363869, -153440588, -597280151}},
{{-169579340, -325789545, 341621267, -808015043, 1496005628, 1698607573, 1253108625, -888282641}, {1948606589, 748396264, -537344099, 1429927372, 9967642, -122561796, 764870871, -372187339}, {0, 0, 0, 0, 150, -13, 1, 2}, {-169579340, -325789545, 341621267, -808015043, 859328, 105304225, 488237754, -143907963}},
{{1529552645, -716962915, 1380553359, 571623607, 1085299154, 1357534008, 158260936, 1195642461}, {-55172483, 375112016, 1906964975, -61795618, 1200827421, 363742805, 654898790, 1588347497}, {-27, -1, 0, -9, 0, 3, 0, 0}, {39895604, -341850899, 1380553359, 15463045, 1085299154, 266305593, 158260936, 1195642461}},
{{994898156, 1135442549, 976180472, 1400804359, 866707530, 707736802, 198393746, 1261075906}, {-555303557, -746907521, 1828145916, 705143021, -2128798558, 1993567557, 1705308305, -1892652100,}, {-1, -1, 0, 1, 0, 0, 0, 0}, {439594599, 388535028, 976180472, 695661338, 866707530, 707736802, 198393746, 1261075906}},
{{-151869287, 1367685846, -376831150, 1020032026, -228079285, 1150064788, 744721971, -280666313}, {730245388, -147006946, 1984600644, 1265751744, -1652204050, 1455925436, -567101230, 1353708945}, {0, -9, 0, 0, 0, 0, -1, 0}, {-151869287, 44623332, -376831150, 1020032026, -228079285, 1150064788, 177620741, -280666313}},
{{953656477, 1410990952, 467191960, 93495458, -206793379, 626237782, 126129132, -376974649}, {719599583, 1144944789, -1045964464, 432065482, -8579385, 912877091, 672343763, -260827652}, {1, 1, 0, 0, 24, 0, 0, 1}, {234056894, 266046163, 467191960, 93495458, -888139, 626237782, 126129132, -116146997}},
{{403332342, 768201719, 543586514, 143270527, 1584668346, 522965783, 835904258, 1285581190}, {1549359691, 1858081072, 1394477977, 1506774133, 21453743, 1900871663, 1071677478, 194564254}, {0, 0, 0, 0, 73, 0, 0, 6}, {403332342, 768201719, 543586514, 143270527, 18545107, 522965783, 835904258, 118195666}},
{{611115651, 867593495, -565047037, 269144960, -167186294, 1238864585, 1153128116, -410671730}, {732594130, 1468417879, 196626094, 327726309, -31336045, 619151238, 1024569669, 710360926}, {0, 0, -2, 0, 5, 2, 1, 0}, {611115651, 867593495, -171794849, 269144960, -10506069, 562109, 128558447, -410671730}},
{{1031102250, 1203359879, 114767652, 180870776, 408145498, -164059549, 559125319, 625113564}, {1271494678, 651794691, 442449771, 977248824, 143979289, 498299198, 494822427, 48113935}, {0, 1, 0, 0, 2, 0, 1, 12}, {1031102250, 551565188, 114767652, 180870776, 120186920, -164059549, 64302892, 47746344}},
{{1395561930, 1184547065, 366393924, 416038713, -294898167, 1049933002, 1232242168, 1292028578}, {498721857, 815643315, -325613764, 277943189, 1046676176, -425402458, 55029349, -6747282}, {2, 1, -1, 1, 0, -2, 22, -191}, {398118216, 368903750, 40780160, 138095524, -294898167, 199128086, 21596490, 3297716}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__divmodv8si4(tests[i][0], tests[i][1], tests[i][2], tests[i][3]))
      return 1;

  return 0;
}
