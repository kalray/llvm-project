// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_divv16hi3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef short elt;
typedef elt vt __attribute__((__vector_size__(32)));
vt __divv16hi3(vt a, vt b);

int test__divv16hi3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __divv16hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __divv16hi3 (lane %d): %hd / %hd = %hd, "
             "expected %hd\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
{{-6688, -11103, 6042, 16639, 16427, 8820, 19739, 193, 18255, 22086, 13134, 11464, 2917, 25758, 4761, 23137},
 {23778, -12716, -1687, 9988, 2979, 9787, -2340, -9112, 19526, 18217, 6025, 5201, 4324, 8528, 4827, -11208},
 {0, 0, -3, 1, 5, 0, -8, 0, 0, 1, 2, 2, 0, 3, 0, -2}},
{{-2587, -4971, 5209, -12327, 22831, 25917, 19112, -13553, 18791, 17024, -6508, 11832, -2826, -11653, 14011, 3432},
 {-18420, -23655, 19377, 18710, 19538, 30500, 74, 9131, 21271, 28911, 29909, 16587, 22633, 12471, 7369, 15223},
 {0, 0, 0, 0, 1, 0, 258, -1, 0, 0, 0, 0, 0, 0, 1, 0}},
{{15180, 17324, 14894, 21373, 13225, 10798, 3285, 19240, -9081, -6180, 6829, 10523, 16492, 26355, 23606, 18411},
 {-20737, -2787, 13628, -31263, 16058, -17488, 11437, 4849, 25705, 20740, -20241, 25285, -15804, 23887, -4311, 16636},
 {0, -6, 1, 0, 0, 0, 0, 3, 0, 0, 0, 0, -1, 1, -5, 1}},
{{14551, 21523, 7129, 1426, -3155, 9555, 1924, -5749, 13297, 16789, -10209, -8971, 3348, -3618, 7543, 303},
 {-14583, 8934, 21922, -29077, -25299, -9509, 24191, 24464, -19762, -20505, -6093, -18687, -15464, -22201, 10116, 21376},
 {0, 2, 0, 0, 0, -1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0}},
{{9324, 13240, -8621, 4106, -2550, 18901, 17594, -6266, 5023, 10684, -5293, 2814, -761, 1467, 2878, 9035},
 {1149, 27295, 23673, -26318, -19072, -12012, 32722, -31534, -9686, -23797, 3279, -7883, -13107, -14607, 15704, 28376},
 {8, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0}},
{{21301, 18074, 5590, 6348, -4499, 16019, 18801, 19714, -8123, 4029, -6720, 1481, 14136, -3987, -141, -831},
 {-2570, -27361, -25321, 27114, -23319, -7123, 28380, -30927, 15991, -7314, 16975, -13530, 1399, -18855, 10979, -16613},
 {-8, 0, 0, 0, 0, -2, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0}},
{{13695, 427, -3339, 23864, 21871, 8864, 22968, -6674, -160, -265, 12022, 20675, -1634, 940, 103, 509},
 {927, -20865, -10383, 31928, -13839, -7191, 29070, -17100, -28001, -3361, 21056, 11081, 8785, -3219, -32510, 3426},
 {14, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0}},
{{9036, 15655, -98, 7616, -6486, 25061, -14650, 4049, 18253, 13636, 9640, 4049, -1284, -4692, -3115, -8458},
 {4767, -26437, 1540, -6895, -17281, -14580, -16310, 11732, -26787, -8255, 18908, -31990, 9538, 1213, 30248, 17936},
 {1, 0, 0, -1, 0, -1, 0, 0, 0, -1, 0, 0, 0, -3, 0, 0}},
{{30593, -10435, 11314, 6509, 11962, 6565, 3580, 22379, -163, 2453, 20671, 18127, 7529, 8600, 25066, 6318},
 {3207, -30490, 209, -4068, -25630, 13568, 14234, 21621, -24012, -2209, -28475, -7029, 22388, 15040, -16299, 10416},
 {9, 0, 54, -1, 0, 0, 0, 1, 0, -1, 0, -2, 0, 0, -1, 0}},
{{31999, 26257, -4910, -9859, 10591, 3346, 18446, 9785, 28626, 8823, 8302, -5836, 12273, 4160, 2146, -301},
 {23247, -16658, 17760, 23201, -15623, 19475, 16639, -26006, -17291, -2340, -30500, -12287, -29313, 28593, 2610, 29015},
 {1, -1, 0, 0, 0, 0, 1, 0, -1, -3, 0, 0, 0, 0, 0, 0}},
{{10707, 15579, 9551, 19680, 28543, -5668, 10237, 0, 520, -856, -195, -1641, 218, 12417, 15758, -4802},
 {-22929, -14345, 29671, -21865, -3477, 29749, -32055, -27120, -21930, 19105, -30952, -18280, -31331, -10248, 21289, -29779},
 {0, -1, 0, 0, -8, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__divv16hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
