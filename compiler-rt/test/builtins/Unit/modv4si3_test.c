// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_modv4si3

#include <stdio.h>

// Returns: a % b

typedef int v4si __attribute__((__vector_size__(16)));
v4si __modv4si3(v4si a, v4si b);

int test__modv4si3(v4si a, v4si b, v4si expected_r) {
  v4si r = __modv4si3(a, b);
  int res = 0;
  for (int lane = 0; lane < 4; ++lane)
    if (r[lane] != expected_r[lane]) {
      printf("error in __modv4si3 (lane %d): %X %% %X = %X, expected %X\n",
             lane, a[lane], b[lane], r[lane], expected_r[lane]);
      res = 1;
    }
  return res;
}

v4si tests[][3] = {
    {{1, -1, 12, -101}, {10, 11, -11, -100}, {1, -1, 1, -1}},
    {{100, -100, 0, -90}, {101, 95, 1, -90}, {100, -5, 0, 0}},
    {{733700828, -1074162816, 413913109, -556347615},
     {-1815467615, -919985178, -1322016045, 1583839069},
     {733700828, -154177638, 413913109, -556347615}},
    {{192122961, -1248985855, -1965301596, 962903448},
     {1330680247, 197659806, 371462822, 625159208},
     {192122961, -63027019, -107987486, 337744240}},
    {{-473446056, -1885002826, -1329739918, 694244762},
     {-1006533030, 669877777, -1581767944, -1991822045},
     {-473446056, -545247272, -1329739918, 694244762}},
    {{1968609741, -721055534, -1897882074, 1395138371},
     {176768800, 1788120164, -1907778547, -119548576},
     {24152941, -721055534, -1897882074, 80104035}},
    {{-880105757, -172944621, -1544811341, -174836565},
     {286612271, -1844516226, -266317530, 545040488},
     {-20268944, -172944621, -213223691, -174836565}},
    {{-2041766522, -701876326, 1636238353, 958632046},
     {1633490388, 1463002378, 194922800, -438325539},
     {-408276134, -701876326, 76855953, 81980968}},
    {{-1674451568, 237173857, -946231059, 1850275033},
     {125213076, 1162166782, -1942173189, -1780757600},
     {-46681580, 237173857, -946231059, 69517433}},
    {{1826314779, -1445160934, 1530069416, -1508360306},
     {2115611076, -417334116, -1348200977, -1949286028},
     {1826314779, -193158586, 181868439, -1508360306}},
    {{-1848566610, 1725330595, 1575948078, -1712010144},
     {-640968039, 1292957176, -913200066, -2142191326},
     {-566630532, 432373419, 662748012, -1712010144}},
    {{-632700240, -1388821215, 86851889, -1068298093},
     {-1031163971, -204901895, -638919784, 1959499806},
     {-632700240, -159409845, 86851889, -1068298093}},
    {{-777600566, -1080493993, -749958848, 1385217778},
     {182532454, -365743904, 1849915232, -459173975},
     {-47470750, -349006185, -749958848, 7695853}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__modv4si3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
