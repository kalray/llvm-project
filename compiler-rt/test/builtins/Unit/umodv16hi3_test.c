// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_umodv16hi3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef unsigned short elt;
typedef elt vt __attribute__((__vector_size__(32)));
vt __umodv16hi3(vt a, vt b);

int test__umodv16hi3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __umodv16hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __umodv16hi3 (lane %d): %hu / %hu = %hu, "
             "expected %hu\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
{{11195, 49144, 6315, 57045, 37833, 51497, 45362, 24167, 57271, 48829, 29231, 23181, 48005, 17053, 25840, 50906},
 {55380, 37735, 46893, 5440, 29873, 7206, 35732, 25604, 37263, 62853, 56866, 10695, 18056, 17063, 60561, 28569},
 {11195, 11409, 6315, 2645, 7960, 1055, 9630, 24167, 20008, 48829, 29231, 1791, 11893, 17053, 25840, 22337}},
{{62932, 19772, 11702, 64289, 9636, 11161, 34676, 34307, 54697, 40757, 57451, 19086, 32444, 1984, 32877, 7331},
 {36058, 52063, 31281, 32421, 6857, 2614, 3122, 5119, 306, 37182, 29114, 52153, 48426, 58497, 4088, 25996},
 {26874, 19772, 11702, 31868, 2779, 705, 334, 3593, 229, 3575, 28337, 19086, 32444, 1984, 173, 7331}},
{{36335, 49045, 32973, 28759, 26252, 26801, 6971, 648, 64755, 41321, 19548, 28908, 26489, 44663, 4358, 4380},
 {33846, 38007, 18511, 4322, 25376, 158, 41098, 33748, 24910, 32161, 30994, 37004, 30278, 31690, 31998, 2542,},
 {2489, 11038, 14462, 2827, 876, 99, 6971, 648, 14935, 9160, 19548, 28908, 26489, 12973, 4358, 1838}},
{{51428, 15561, 17954, 53571, 46980, 8046, 26856, 5530, 60013, 33077, 1816, 41660, 36620, 23576, 58898, 37943},
 {54629, 7056, 46902, 18325, 7654, 247, 13978, 65036, 20967, 16573, 39365, 37972, 63045, 21516, 22307, 8506},
 {51428, 1449, 17954, 16921, 1056, 142, 12878, 5530, 18079, 16504, 1816, 3688, 36620, 2060, 14284, 3919}},
{{42104, 53151, 55864, 23441, 55329, 49109, 6872, 39093, 10513, 14009, 38942, 34744, 63984, 44680, 6432, 42318},
 {3675, 7012, 57333, 63910, 53628, 64877, 56483, 42417, 10755, 61252, 37407, 59707, 49942, 31959, 13345, 48007},
 {1679, 4067, 55864, 23441, 1701, 49109, 6872, 39093, 10513, 14009, 1535, 34744, 14042, 12721, 6432, 42318}},
{{29201, 2844, 47271, 53851, 17877, 38926, 62133, 21823, 19176, 45256, 52936, 1817, 51319, 41822, 8740, 64065},
 {31634, 45190, 63104, 42602, 26589, 14788, 39747, 39686, 1857, 593, 7247, 19258, 50062, 13386, 16861, 49386},
 {29201, 2844, 47271, 11249, 17877, 9350, 22386, 21823, 606, 188, 2207, 1817, 1257, 1664, 8740, 14679}},
{{13377, 44062, 42749, 47158, 45010, 35102, 35334, 42013, 14319, 40235, 26582, 12345, 31417, 54287, 20760, 61729},
 {62873, 54479, 39094, 58498, 34725, 6364, 46523, 23590, 26798, 37078, 12374, 43989, 25497, 65133, 44474, 37866},
 {13377, 44062, 3655, 47158, 10285, 3282, 35334, 18423, 14319, 3157, 1834, 12345, 5920, 54287, 20760, 23863}},
{{49546, 26248, 35689, 64340, 42915, 35365, 2008, 8563, 9002, 26877, 37602, 51963, 45873, 17640, 1538, 38028},
 {47515, 9022, 25084, 64382, 28078, 2010, 44384, 64126, 31183, 44485, 53703, 48852, 62026, 14945, 19042, 33575},
 {2031, 8204, 10605, 64340, 14837, 1195, 2008, 8563, 9002, 26877, 37602, 3111, 45873, 2695, 1538, 4453}},
{{39497, 45838, 41041, 6724, 30315, 1102, 38525, 65170, 27818, 9177, 25887, 35140, 19202, 10045, 11912, 50266},
 {20960, 1352, 53336, 12613, 40016, 47064, 58678, 15921, 45803, 11235, 5718, 12548, 11972, 34395, 61681, 17174},
 {18537, 1222, 41041, 6724, 30315, 1102, 38525, 1486, 27818, 9177, 3015, 10044, 7230, 10045, 11912, 15918}},
{{63925, 29067, 25282, 32832, 54824, 43116, 7972, 60414, 5233, 4632, 3659, 21345, 49394, 60247, 56235, 875},
 {4934, 60067, 2074, 54332, 13616, 22311, 17075, 20568, 62349, 34899, 37412, 45558, 30971, 50038, 39561, 10468},
 {4717, 29067, 394, 32832, 360, 20805, 7972, 19278, 5233, 4632, 3659, 21345, 18423, 10209, 16674, 875}},
{{48720, 31896, 55286, 4783, 12407, 22537, 39121, 56185, 16236, 44637, 45739, 41424, 15589, 60405, 58354, 5377},
 {13496, 44149, 33551, 35633, 21169, 64297, 43180, 1318, 48190, 15569, 55010, 31170, 39762, 2650, 44886, 24443},
 {8232, 31896, 21735, 4783, 12407, 22537, 39121, 829, 16236, 13499, 45739, 10254, 15589, 2105, 13468, 5377}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__umodv16hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
