// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_modv16hi3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef short elt;
typedef elt vt __attribute__((__vector_size__(32)));
vt __modv16hi3(vt a, vt b);

int test__modv16hi3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __modv16hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __modv16hi3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
{{-6688, -11103, 6042, 16639, 16427, 8820, 19739, 193, 18255, 22086, 13134, 11464, 2917, 25758, 4761, 23137},
 {23778, -12716, -1687, 9988, 2979, 9787, -2340, -9112, 19526, 18217, 6025, 5201, 4324, 8528, 4827, -11208},
 {-6688, -11103, 981, 6651, 1532, 8820, 1019, 193, 18255, 3869, 1084, 1062, 2917, 174, 4761, 721}},
{{-9275, -16074, 6193, -5677, 24358, -30799, 20139, -13360, -28490, 20892, -5426, 12892, 91, -11482, 18772, 4155},
 {-18420, -23655, 19377, 18710, 19538, 30500, 74, 9131, 21271, 28911, 29909, 16587, 22633, 12471, 7369, 15223},
 {-9275, -16074, 6193, -5677, 4820, -299, 11, -4229, -7219, 20892, -5426, 12892, 91, -11482, 4034, 4155}},
{{5905, 1250, 21087, 15696, 18044, 10499, 3038, 15012, -16300, 14712, 1403, 23415, 16583, 14873, 27639, 22566},
 {-20737, -2787, 13628, -31263, 16058, -17488, 11437, 4849, 25705, 20740, -20241, 25285, -15804, 23887, -4311, 16636},
 {5905, 1250, 7459, 15696, 1986, 10499, 3038, 465, -16300, 14712, 1403, 23415, 779, 14873, 1773, 5930}},
{{20456, 22779, 14587, 17122, -1169, 20054, 4962, -5287, -3003, 31501, -8806, 14444, 4128, 11254, 9321, 6232},
 {-14583, 8934, 21922, -29077, -25299, -9509, 24191, 24464, -19762, -20505, -6093, -18687, -15464, -22201, 10116, 21376},
 {5873, 4911, 14587, 17122, -1169, 1036, 4962, -5287, -3003, 10996, -2713, 14444, 4128, 11254, 9321, 6232}},
{{15197, 18149, 5966, 21228, -3719, 19938, 22556, -11553, 2020, 21680, -8007, 17258, 3367, 12721, 12199, 15267},
 {1149, 27295, 23673, -26318, -19072, -12012, 32722, -31534, -9686, -23797, 3279, -7883, -13107, -14607, 15704, 28376},
 {260, 18149, 5966, 21228, -3719, 7926, 22556, -11553, 2020, 21680, -1449, 1492, 3367, 12721, 12199, 15267}},
{{21553, -29313, 11556, 27576, -8218, 23946, -24179, 8161, -6103, 25709, -8168, 2973, 17503, 8734, 12058, 14436},
 {-2570, -27361, -25321, 27114, -23319, -7123, 28380, -30927, 15991, -7314, 16975, -13530, 1399, -18855, 10979, -16613},
 {993, -1952, 11556, 462, -8218, 2577, -24179, 8161, -6103, 3767, -8168, 2973, 715, 8734, 1079, 14436}},
{{14696, -1525, 8217, 24326, 13653, 11443, -1211, 1487, -6263, 3502, 3854, 23648, -929, 9674, 1182, 14945},
 {927, -20865, -10383, 31928, -13839, -7191, 29070, -17100, -28001, -3361, 21056, 11081, 8785, -3219, -32510, 3426},
 {791, -1525, 8217, 24326, 13653, 4252, -1211, 1487, -6263, 141, 3854, 1486, -929, 17, 1182, 1241}},
{{9813, 14130, 8119, 31942, 7168, 29314, -15861, 5536, 11990, 13777, 13494, 5534, -2213, -4675, -1933, -7217},
 {4767, -26437, 1540, -6895, -17281, -14580, -16310, 11732, -26787, -8255, 18908, -31990, 9538, 1213, 30248, 17936},
 {279, 14130, 419, 4362, 7168, 154, -15861, 5536, 11990, 5522, 13494, 5534, -2213, -1036, -1933, -7217}},
{{30871, 3695, 11733, 10872, 19130, 6720, -12281, 27915, 11827, 7976, -31371, 23661, 5316, 7567, 23133, -899},
 {3207, -30490, 209, -4068, -25630, 13568, 14234, 21621, -24012, -2209, -28475, -7029, 22388, 15040, -16299, 10416},
 {2008, 3695, 29, 2736, 19130, 6720, -12281, 6294, 11827, 1349, -2896, 2574, 5316, 7567, 6834, -899}},
{{-31538, 29952, -4935, -7122, 29721, 10066, 6165, 16078, -25083, 10173, 5406, -3260, 17589, 11727, 8981, -1200},
 {23247, -16658, 17760, 23201, -15623, 19475, 16639, -26006, -17291, -2340, -30500, -12287, -29313, 28593, 2610, 29015},
 {-8291, 13294, -4935, -7122, 14098, 10066, 6165, 16078, -7792, 813, 5406, -3260, 17589, 11727, 1151, -1200}},
{{2415, 28874, 4616, 12558, -22895, 4398, 16401, 16078, -7271, -40, 5211, -4901, 17807, 24144, 16909, -6002},
 {-22929, -14345, 29671, -21865, -3477, 29749, -32055, -27120, -21930, 19105, -30952, -18280, -31331, -10248, 21289, -29779},
 {2415, 184, 4616, 12558, -2033, 4398, 16401, 16078, -7271, -40, 5211, -4901, 17807, 3648, 16909, -6002}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__modv16hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
