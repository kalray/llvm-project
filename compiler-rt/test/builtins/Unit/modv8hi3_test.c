// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_modv8hi3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef short elt;
typedef elt vt __attribute__((__vector_size__(16)));
vt __modv8hi3(vt a, vt b);

int test__modv8hi3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __modv8hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __modv8hi3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
    {{-6688, -11103, 6042, 16639, 16427, 8820, 19739, 193},
     {18256, 22087, 13135, 11465, 2918, 25759, 4762, 23138},
     {-6688, -11103, 6042, 5174, 1837, 8820, 691, 193}},
    {{17089, -23820, 4354, 15161, 4815, 18606, -1650, -8920},
     {-27755, -25233, 19159, 16665, 7241, -31250, 9588, 11929},
     {17089, -23820, 4354, 15161, 4815, 18606, -1650, -8920}},
    {{14502, -28791, 9566, 2833, 27641, -21013, 17470, -22473},
     {-8964, -8210, 12649, 28495, 4415, 22630, 23599, 15363},
     {5538, -4161, 9566, 2833, 1151, -21013, 17470, -7110}},
    {{28876, -15100, 30630, 11555, 17710, -300, 19884, 11133},
     {-7219, 2484, -29003, -25655, 22724, 26573, 26141, -23742},
     {0, -196, 1627, 11555, 17710, -300, 19884, 11133}},
    {{15180, 17128, 16521, -32608, 30934, 10498, 22911, 30374},
     {-16300, -3696, -22174, -15132, -26320, -12608, -15790, -5331},
     {15180, 2344, 16521, -2344, 4614, 10498, 7121, 3719}},
    {{12863, 23212, 10772, 13219, 1134, 28046, 18484, -563},
     {-11866, -11867, -6788, -6434, 779, -1192, -27470, -3918},
     {997, 11345, 3984, 351, 355, 630, 18484, -563}},
    {{15548, -32662, 11112, 1777, -2800, 10185, 20408, -6315},
     {1431, 4922, -16997, -15405, 4128, -4811, -19922, -3616},
     {1238, -3130, 11112, 1777, -2800, 563, 486, -2699}},
    {{7392, 8591, 19406, 3963, 21379, 8542, 13240, 16916},
     {21500, 29213, -2849, 6159, 4468, 14637, -5495, 1124},
     {7392, 8591, 2312, 3963, 3507, 8542, 2250, 56}},
    {{16716, 21829, -6309, 8069, 957, 27444, 19844, -6210},
     {26523, -25639, -8143, 8973, 3707, 16104, -2617, 10159},
     {16716, 21829, -6309, 8069, 957, 11340, 1525, -6210}},
    {{32448, -25346, -4558, 10828, 7184, 8837, 10056, 3328},
     {-28937, -28931, 1229, 19777, 6064, 23698, 2971, 17159},
     {3511, -25346, -871, 10828, 1120, 8837, 1143, 3328}},
    {{24804, -7272, 4719, 17176, -3379, 24857, 19944, 23042},
     {28476, -24902, -5490, 21258, 20200, 19711, 2830, 16328},
     {24804, -7272, 4719, 17176, -3379, 5146, 134, 6714}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__modv8hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
