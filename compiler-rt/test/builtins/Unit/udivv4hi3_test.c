// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_udivv4hi3

#include <stdio.h>

// Returns: a % b

typedef unsigned short v4hu __attribute__((__vector_size__(8)));
v4hu __udivv4hi3(v4hu a, v4hu b);

int test__udivv4hi3(v4hu a, v4hu b, v4hu expected_r) {
  v4hu r = __udivv4hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < 4; ++lane)
    if (r[lane] != expected_r[lane]) {
      printf("error in __udivv4hi3 (lane %d): %X / %X = %X, expected %X\n",
             lane, a[lane], b[lane], r[lane], expected_r[lane]);
      res = 1;
    }
  return res;
}

v4hu tests[][3] = {
    {{1, 1, 12, 101}, {10, 11, 11, 101}, {0, 0, 1, 1}},
    {{1011, 9594, 0, 90}, {101, 95, 1, 91}, {10, 100, 0, 0}},
    {{11195, 49144, 6315, 57045}, {37834, 51498, 45363, 24168}, {0, 0, 0, 2}},
    {{57271, 48829, 29231, 23183}, {20303, 3015, 5667, 9538}, {2, 16, 5, 2}},
    {{55381, 37750, 46897, 5441}, {50175, 10220, 41398, 35141}, {1, 3, 1, 0}},
    {{37263, 62855, 56866, 10694}, {2694, 27282, 36422, 63709}, {13, 2, 1, 0}},
    {{51750, 8365, 5388, 61644}, {4370, 37388, 61468, 8313}, {11, 0, 0, 7}},
    {{34700, 57464, 28220, 17302}, {24921, 22319, 2969, 58843}, {1, 2, 9, 0}},
    {{46215, 14330, 49933, 26981}, {1905, 17727, 35895, 38358}, {24, 0, 1, 0}},
    {{28603, 39865, 37785, 41458}, {32275, 59161, 44958, 35785}, {0, 0, 0, 1}},
    {{9461, 29273, 21271, 62428}, {55748, 19721, 51595, 32840}, {0, 1, 0, 1}},
    {{64526, 37747, 56747, 9823}, {49793, 62400, 55780, 29889}, {1, 0, 1, 0}},
    {{63325, 51480, 52767, 37437}, {2776, 59944, 28220, 58518}, {22, 0, 1, 0}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__udivv4hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
