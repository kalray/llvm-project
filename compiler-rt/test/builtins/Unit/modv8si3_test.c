// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_modv8si3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef int elt;
typedef elt vt __attribute__((__vector_size__(32)));
vt __modv8si3(vt a, vt b);

int test__modv8si3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __modv8si3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __modv8si3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
  {{-6688, -11103, 6042, 16639, 16427, 8820, 19739, 193},
  {18256, 22087, 13135, 11465, 2918, 25759, 4762, 23138},
  {-6688, -11103, 6042, 5174, 1837, 8820, 691, 193}},
  {{17089, -23820, 4354, 15161, 4815, 18606, -1650, -8920},
  {37781, 40303, 19159, 16665, 7241, 34286, 9588, 11929},
  {17089, -23820, 4354, 15161, 4815, 18606, -1650, -8920}},
  {{14502, -28791, 9566, 2833, 27641, 44523, 17470, -22473},
  {56572, 57326, 12649, 28495, 4415, 22630, 23599, 15363},
  {14502, -28791, 9566, 2833, 1151, 21893, 17470, -7110}},
  {{37840, -39730, 30630, 11555, 17710, 42606, 19884, 11133},
  {58317, 68020, 36533, 39881, 22724, 26573, 26141, 41794},
  {37840, -39730, 30630, 11555, 17710, 16033, 19884, 11133}},
  {{53020, -22406, 45524, 32928, 30934, 26831, 22911, 30374},
  {49236, 61840, 43362, 50404, 39216, 52928, 49746, 60205},
  {3784, -22406, 2162, 32928, 30934, 26831, 22911, 30374}},
  {{1467, -1538, -3587, 48491, 27454, 44379, 34274, 26092},
  {53670, 53669, 58748, 59102, 66315, 64344, 38066, 61618},
  {1467, -1538, -3587, 48491, 27454, 44379, 34274, 26092}},
  {{16018, 19991, 3541, 49917, 24299, 53934, 36198, 20340},
  {66967, 70458, 48539, 50131, 69664, 60725, 45614, 61920},
  {16018, 19991, 3541, 49917, 24299, 53934, 36198, 20340}},
  {{22172, 31712, 11835, 52103, 48478, 61913, 48952, 39955},
  {87036, 94749, 62687, 71695, 70004, 80173, 60041, 66660},
  {22172, 31712, 11835, 52103, 48478, 61913, 48952, 39955}},
  {{31496, 44950, 3214, 56209, 45928, 80815, 66546, 33689},
  {92059, 105433, 57393, 74509, 69243, 81640, 62919, 75695},
  {31496, 44950, 3214, 56209, 45928, 80815, 3627, 33689}},
  {{47228, 63311, 4965, 58968, 52155, 78312, 12158, 43227},
  {102135, 102141, 66765, 85313, 71600, 89234, 68507, 82695},
  {47228, 63311, 4965, 58968, 52155, 78312, 12158, 43227}},
  {{68521, 81385, 10555, 65316, 47656, 94332, 30959, 62941},
  {94012, 106170, 60046, 86794, 85736, 85247, 68366, 81864},
  {68521, 81385, 10555, 65316, 47656, 9085, 30959, 62941}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__modv8si3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
