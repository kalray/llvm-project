// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_divmodv16hi4

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef short elt;
typedef elt vt __attribute__((__vector_size__(32)));
vt __divmodv16hi4(vt a, vt b, vt *r);

int test__divmodv16hi4(vt a, vt b, vt expected_q, vt expected_rem) {
  const int N = sizeof(vt) / sizeof(elt);
  vt rem;
  vt q = __divmodv16hi4(a, b, &rem);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected_q[lane] || rem[lane] != expected_rem[lane]) {
      printf("error in __divmodv16hi4 (lane %d): %d divmod %d = q(%d), "
             "rem(%d), expected q(%d), rem (%d)\n",
             lane, a[lane], b[lane], q[lane], rem[lane], expected_q[lane],
             expected_rem[lane]);
      res = 1;
    }
  return res;
}

vt tests[][4] = {
{{-6688, -11103, 6042, 16639, 16427, 8820, 19739, 193, 18255, 22086, 13134, 11464, 2917, 25758, 4761, 23137},
 {23778, -12716, -1687, 9988, 2979, 9787, -2340, -9112, 19526, 18217, 6025, 5201, 4324, 8528, 4827, -11208},
 {0, 0, -3, 1, 5, 0, -8, 0, 0, 1, 2, 2, 0, 3, 0, -2},
 {-6688, -11103, 981, 6651, 1532, 8820, 1019, 193, 18255, 3869, 1084, 1062, 2917, 174, 4761, 721}},
{{-2587, -4971, 5209, -12327, 22831, 25917, 19112, -13553, 18791, 17024, -6508, 11832, -2826, -11653, 14011, 3432},
 {16650, -22042, 22045, 15373, 18091, 29533, 3433, 18436, 20000, 14563, 24968, 12448, 21226, 4117, 7303, 27152},
 {0, 0, 0, 0, 1, 0, 5, 0, 0, 1, 0, 0, 0, -2, 1, 0},
 {-2587, -4971, 5209, -12327, 4740, 25917, 1947, -13553, 18791, 2461, -6508, 11832, -2826, -3419, 6708, 3432}},
{{15180, 17324, 14894, 21373, 13225, 10798, 3032, 19241, -9081, -6179, 6829, 10523, 16492, 26353, 23606, 18411},
 {-4904, 15897, -540, 3236, 1260, -22071, 13310, -17835, 23225, -5710, 8878, 20530, 24273, 7997, -4972, 4845},
 {-3, 1, -27, 6, 10, 0, 0, -1, 0, 1, 0, 0, 0, 3, -4, 3},
 {468, 1427, 314, 1957, 625, 10798, 3032, 1406, -9081, -469, 6829, 10523, 16492, 2362, 3718, 3876}},
{{14548, 21530, 7101, 1432, -3145, 9555, 1924, -5753, 13297, 16790, -10209, -8971, 3349, -3616, 7544, 305},
 {6622, 13148, 8608, 4143, 24804, 18777, 15786, 21021, 10988, 23822, 20977, 32087, 16832, 21810, 18145, 8616},
 {2, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0},
 {1304, 8382, 7101, 1432, -3145, 9555, 1924, -5753, 2309, 16790, -10209, -8971, 3349, -3616, 7544, 305}},
{{9326, 13239, -8621, 4106, -2550, 18902, 17594, -6266, 5024, 10684, -5294, 2814, -761, 1467, 2878, 9035},
 {17036, 26743, 8852, 4191, 3082, 7052, 10455, 3785, 12385, 13498, -837, 1833, 5706, 3978, 13132, 7305},
 {0, 0, 0, 0, 0, 2, 1, -1, 0, 0, 6, 1, 0, 0, 0, 1},
 {9326, 13239, -8621, 4106, -2550, 4798, 7139, -2481, 5024, 10684, -272, 981, -761, 1467, 2878, 1730}},
{{21293, 18074, 5590, 6348, -4499, 16022, 18802, 19713, -8123, 4029, -6713, 1482, 14136, -3987, -141, -830},
 {5607, 24119, 7921, -7998, -6797, 9687, 2797, -1874, 30701, 27167, 13424, -4666, 13745, -2781, -1847, 22277},
 {3, 0, 0, 0, 0, 1, 6, -10, 0, 0, 0, 0, 1, 1, 0, 0},
 {4472, 18074, 5590, 6348, -4499, 6335, 2020, 973, -8123, 4029, -6713, 1482, 391, -1206, -141, -830}},
{{13706, 427, -3339, 23864, 21871, 8867, 22974, -6684, -160, -265, 12022, 20675, -1643, 941, 103, 509},
 {7969, 24570, 20528, 11162, 4981, 6267, 2710, 14800, 13421, 7982, -2632, 26093, 7777, 14430, 21906, 19209},
 {1, 0, 0, 2, 4, 1, 8, 0, 0, 0, -4, 0, 0, 0, 0, 0},
 {5737, 427, -3339, 1540, 1947, 2600, 1294, -6684, -160, -265, 1494, 20675, -1643, 941, 103, 509}},
{{9023, 15655, -98, 7618, -6481, 25063, -14642, 4049, 18253, 13636, 9636, 4048, -1284, -4692, -3115, -8458},
 {9577, -5145, 8584, 28253, -1495, -4789, 21450, 22148, 1054, -5159, -654, -22396, -890, 5373, -2675, 15019},
 {0, -3, 0, 0, 4, -5, 0, 0, 17, -2, -14, 0, 1, 0, 1, 0},
 {9023, 220, -98, 7618, -501, 1118, -14642, 4049, 335, 3318, 480, 4048, -394, -4692, -440, -8458}},
{{30592, -10438, 11314, 6510, 11966, 6561, 3580, 22379, -146, 2452, 20657, 18127, 7530, 8603, 25067, 6318},
 {7463, -3833, -1429, 10445, -8850, 29266, 15902, 13938, 3110, 9364, 18633, 29009, 12456, 9135, 18549, -15978},
 {4, 2, -7, 0, -1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0},
 {740, -2772, 1311, 6510, 3116, 6561, 3580, 8441, -146, 2452, 2024, 18127, 7530, 8603, 6518, 6318}},
{{31994, 26259, -4971, -9858, 10590, 3346, 18446, 9785, 28626, 8824, 8303, -5834, 12273, 4160, 2148, -301},
 {20780, 11060, 18862, -31757, 13123, 12468, 5985, 26350, 6575, 2321, -1, 12869, 21365, 22156, 25427, 24917},
 {1, 2, 0, 0, 0, 0, 3, 0, 4, 3, -8303, 0, 0, 0, 0, 0},
 {11214, 4139, -4971, -9858, 10590, 3346, 491, 9785, 2326, 1861, 0, -5834, 12273, 4160, 2148, -301}},
{{10707, 15582, 9551, 19680, 28543, -5668, 10239, 0, 525, -850, -8498, -1641, 218, 12417, 15758, -4802},
 {30574, 6452, 6940, 10612, 22736, 13620, 17333, 8671, -2313, 23306, -452, -11827, 10255, 30855, 20827, 6441},
 {0, 2, 1, 1, 1, 0, 0, 0, 0, 0, 18, 0, 0, 0, 0, 0},
 {10707, 2678, 2611, 9068, 5807, -5668, 10239, 0, 525, -850, -362, -1641, 218, 12417, 15758, -4802}},
 };

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__divmodv16hi4(tests[i][0], tests[i][1], tests[i][2], tests[i][3]))
      return 1;

  return 0;
}
