// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_udivv8si3

#include <stdio.h>

// Returns: a / b

typedef unsigned elt;
typedef elt vt __attribute__((__vector_size__(32)));
vt __udivv8si3(vt a, vt b, vt *r);

int test__udivv8si3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt rem;
  vt q = __udivv8si3(a, b, &rem);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __udivv8hi3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
{{733700828, 3220804480, 413913109, 3738619681, 2479499680, 3374982117, 2972951250, 1583839068},
 {3753389430, 3200159080, 1915752592, 1519251064, 3146147863, 1117644985, 1693478868, 3336287436},
 {0, 1, 0, 2, 0, 3, 1, 0}},
{{3629398279, 2472991490, 3073214864, 356500524, 1957754019, 472217974, 2341736531, 1677986043},
 {1900477931, 3024350818, 1347610436, 2220144673, 34482397, 2235887372, 1367468265, 913593609},
 {1, 0, 2, 0, 56, 0, 1, 1}},
{{3390708599, 548110913, 353070735, 4040026696, 109843527, 662330906, 1641461018, 664589065},
 {4173947649, 2495419113, 3197072480, 3353613284, 1381360514, 1248438680, 1828708595, 4225194878},
 {0, 0, 0, 1, 0, 0, 0, 0}},
{{3028791862, 939050183, 3271880284, 1768294066, 2786689984, 3994131700, 2157871307, 2952535235},
 {1751976712, 813084322, 1378405659, 1775735545, 3371758514, 3963905078, 2422680807, 4056666450},
 {1, 1, 2, 0, 0, 1, 0, 0}},
{{620085908, 1918489182, 1394079641, 4091317458, 1538388181, 1710291293, 435000911, 4102061998},
 {1685907004, 3286856984, 802509536, 2419447596, 2981562582, 2466046007, 2696961089, 3863390286},
 {0, 0, 1, 1, 0, 0, 0, 1}},
{{4150066970, 3373883148, 3458156560, 2453515872, 1213696425, 4134125287, 2488835016, 1876293516},
 {3298393094, 2957895169, 925772434, 1426708758, 1792315221, 709272740, 231171137, 2326406427},
 {1, 1, 3, 1, 0, 5, 10, 0}},
{{3207321499, 296432415, 228900064, 3325651784, 3021524441, 520835448, 1303251622, 320008793},
 {1957761084, 230402428, 4058710982, 2262449765, 2456283603, 1404165761, 3805584172, 397695364},
 {1, 1, 0, 1, 1, 0, 0, 0}},
{{1362118944, 2266610458, 1860674130, 917742014, 3133627973, 5881109, 2517729136, 2050580570},
 {1699453025, 3503848528, 312356872, 2325921814, 308771439, 737464584, 3170567053, 788573876},
 {0, 0, 5, 0, 10, 0, 0, 2}},
{{3684019700, 3388446665, 2484536330, 427302447, 3556953359, 3209184806, 3901426217, 2199634961},
 {1203667174, 3340413997, 2745502231, 66298038, 2102164487, 3530675695, 2656036724, 3305144183},
 {3, 1, 0, 6, 1, 0, 1, 0}},
{{955682219, 4292161079, 683670731, 2987567958, 3013045628, 4235721025, 2785705454, 2812691001},
 {534528615, 1973625838, 2617290025, 1490760357, 1243523956, 4215139748, 2068825013, 1598997114},
 {1, 2, 0, 2, 2, 1, 1, 1}},
{{1803709705, 4214896556, 3731883704, 1993024019, 1060185155, 3627694912, 3621699872, 3163271641},
 {1102300911, 4021487572, 1691024424, 3627904595, 3686580431, 1827397517, 2220131114, 3024274573},
 {1, 1, 2, 0, 0, 1, 1, 1}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__udivv8si3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
