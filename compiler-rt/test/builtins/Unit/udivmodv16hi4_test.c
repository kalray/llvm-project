// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_udivmodv16hi4

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef unsigned short v16hu __attribute__((__vector_size__(32)));
v16hu __udivmodv16hi4(v16hu a, v16hu b, v16hu *r);

int test__udivmodv16hi4(v16hu a, v16hu b, v16hu expected_q, v16hu expected_rem) {
  v16hu rem;
  v16hu q = __udivmodv16hi4(a, b, &rem);
  int res = 0;
  for (int lane = 0; lane < 4; ++lane)
    if (q[lane] != expected_q[lane] || rem[lane] != expected_rem[lane]) {
      printf(
          "error in __udivmodv16hi4 (lane %d): %X divmod %X = q(%X), rem(%X), "
          "expected q(%X), rem (%X)\n",
          lane, a[lane], b[lane], q[lane], rem[lane], expected_q[lane],
          expected_rem[lane]);
      res = 1;
    }
  return res;
}

v16hu tests[][4] = {
{{11195, 49144, 6315, 57045, 37833, 51497, 45362, 24167, 57271, 48829, 29231, 23181, 48005, 17053, 25840, 50906},
 {55380, 37735, 46893, 5440, 29873, 7206, 35732, 25604, 37263, 62853, 56866, 10695, 18056, 17063, 60561, 28569},
 {0, 1, 0, 10, 1, 7, 1, 0, 1, 0, 0, 2, 2, 0, 0, 1},
 {11195, 11409, 6315, 2645, 7960, 1055, 9630, 24167, 20008, 48829, 29231, 1791, 11893, 17053, 25840, 22337}},
{{51737, 8364, 5387, 61654, 1677, 10113, 25047, 10140, 34690, 57464, 28220, 17297, 20553, 50467, 7037, 50531},
 {57409, 25737, 56239, 29626, 50480, 61999, 42556, 3682, 48587, 23158, 1479, 43249, 42263, 58487, 34903, 19764},
 {0, 0, 0, 2, 0, 0, 0, 2, 0, 2, 19, 0, 0, 0, 0, 2},
 {51737, 8364, 5387, 2402, 1677, 10113, 25047, 2776, 34690, 11148, 119, 17297, 20553, 50467, 7037, 11003}},
{{9461, 29273, 21271, 62429, 23473, 26096, 6637, 62593, 64526, 37748, 56766, 9822, 59581, 42679, 4185, 62587},
 {49525, 59844, 58153, 39839, 20196, 7657, 63023, 31405, 59294, 6127, 1999, 2148, 2405, 23660, 34947, 53085,},
 {0, 0, 0, 1, 1, 3, 0, 1, 1, 6, 28, 4, 24, 1, 0, 1},
 {9461, 29273, 21271, 22590, 3277, 3125, 6637, 31188, 5232, 986, 794, 1230, 1861, 19019, 4185, 9502}},
{{48939, 4523, 3492, 50745, 46105, 7950, 19885, 4883, 45079, 23923, 47832, 12756, 10155, 10604, 54540, 36106},
 {30244, 63858, 49662, 36593, 51091, 3214, 45053, 62476, 1289, 50934, 9165, 2198, 34628, 8845, 60030, 15466,},
 {1, 0, 0, 1, 0, 2, 0, 0, 34, 0, 5, 5, 0, 1, 0, 2},
 {18695, 4523, 3492, 14152, 46105, 1522, 19885, 4883, 1253, 23923, 2007, 1766, 10155, 1759, 54540, 5174}},
{{56213, 51702, 37910, 6521, 54273, 48969, 59530, 33563, 58004, 63041, 37131, 31061, 27364, 42621, 57684, 38401},
 {33277, 4479, 13923, 59737, 26543, 616, 62390, 47800, 56577, 3066, 49, 23501, 62588, 12202, 45578, 44675},
 {1, 11, 2, 0, 2, 79, 0, 0, 1, 20, 757, 1, 0, 3, 1, 0},
 {22936, 2433, 10064, 6521, 1187, 305, 59530, 33563, 1427, 1721, 38, 7560, 27364, 6015, 12106, 38401}},
{{27523, 64324, 56945, 30410, 16178, 55432, 55261, 48266, 8664, 31267, 52158, 32610, 37277, 29104, 2309, 21747},
 {50895, 40611, 15835, 50749, 39684, 15752, 42794, 30832, 58065, 6598, 35414, 32647, 27484, 52978, 15622, 39780},
 {0, 1, 3, 0, 0, 3, 1, 1, 0, 4, 1, 0, 1, 0, 0, 0},
 {27523, 23713, 9440, 30410, 16178, 8176, 12467, 17434, 8664, 4875, 16744, 32610, 9793, 29104, 2309, 21747}},
{{49712, 41219, 61017, 35909, 27133, 25755, 12949, 20191, 13713, 40051, 24376, 10528, 30161, 52623, 12020, 47050},
 {58762, 33002, 50966, 46306, 24314, 65288, 19243, 1338, 33605, 41360, 21871, 57341, 50764, 15315, 29922, 10227},
 {0, 1, 1, 0, 1, 0, 0, 15, 0, 0, 1, 0, 0, 3, 0, 4},
 {49712, 8217, 10051, 35909, 2819, 25755, 12949, 121, 13713, 40051, 2505, 10528, 30161, 6678, 12020, 6142}},
{{36169, 47723, 32035, 17182, 32631, 32083, 32210, 55691, 60219, 23720, 35769, 39618, 39953, 28892, 46314, 14169},
 {34354, 28296, 61577, 41793, 61708, 21401, 10810, 40657, 18098, 47458, 43834, 15391, 1154, 22026, 52124, 1851},
 {1, 1, 0, 0, 0, 1, 2, 1, 3, 0, 0, 2, 34, 1, 0, 7},
 {1815, 19427, 32035, 17182, 32631, 10682, 10590, 15034, 5925, 23720, 35769, 8836, 717, 6866, 46314, 1212}},
{{37467, 37635, 30436, 7920, 15478, 65444, 36519, 56608, 18819, 47836, 53821, 32031, 38899, 7351, 10374, 45820},
 {40796, 11757, 60287, 30949, 44569, 55736, 24884, 32365, 20545, 56006, 53320, 38068, 16199, 26316, 23417, 50347},
 {0, 3, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 2, 0, 0, 0},
 {37467, 2364, 30436, 7920, 15478, 9708, 11635, 24243, 18819, 47836, 501, 32031, 6501, 7351, 10374, 45820}},
{{45388, 27848, 49777, 26108, 24509, 42015, 34984, 58929, 42951, 60991, 645, 11301, 42166, 50202, 44323, 50493},
 {21441, 61079, 44710, 49639, 54614, 50491, 35568, 28890, 35365, 5964, 32195, 65041, 25500, 22994, 53790, 39114},
 {2, 0, 1, 0, 0, 0, 0, 2, 1, 10, 0, 0, 1, 2, 0, 1},
 {2506, 27848, 5067, 26108, 24509, 42015, 34984, 1149, 7586, 1351, 645, 11301, 16666, 4214, 44323, 11379}},
{{44005, 2829, 54893, 37487, 12047, 1732, 31149, 36909, 11004, 40015, 42080, 20079, 62703, 50198, 41680, 4503},
 {11068, 11930, 36544, 7409, 32062, 18465, 61089, 47435, 58963, 47557, 18243, 62449, 25457, 22362, 49648, 25354},
 {3, 0, 1, 5, 0, 0, 0, 0, 0, 0, 2, 0, 2, 2, 0, 0},
 {10801, 2829, 18349, 442, 12047, 1732, 31149, 36909, 11004, 40015, 5594, 20079, 11789, 5474, 41680, 4503}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__udivmodv16hi4(tests[i][0], tests[i][1], tests[i][2], tests[i][3]))
      return 1;

  return 0;
}
