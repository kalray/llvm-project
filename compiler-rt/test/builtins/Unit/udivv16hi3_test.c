// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_udivv16hi3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef unsigned short elt;
typedef elt vt __attribute__((__vector_size__(32)));
vt __udivv16hi3(vt a, vt b);

int test__udivv16hi3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __udivv16hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __udivv16hi3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
{{11195, 49144, 6315, 57045, 37833, 51497, 45362, 24167, 57271, 48829, 29231, 23181, 48005, 17053, 25840, 50906},
 {55380, 37735, 46893, 5440, 29873, 7206, 35732, 25604, 37263, 62853, 56866, 10695, 18056, 17063, 60561, 28569},
 {0, 1, 0, 10, 1, 7, 1, 0, 1, 0, 0, 2, 2, 0, 0, 1}},
{{51737, 8364, 5387, 61654, 1677, 10113, 25047, 10140, 34690, 57464, 28220, 17297, 20553, 50467, 7037, 50531},
 {36058, 52063, 31281, 32421, 6857, 2614, 3122, 5119, 306, 37182, 29114, 52153, 48426, 58497, 4088, 25996},
 {1, 0, 0, 1, 0, 3, 8, 1, 113, 1, 0, 0, 0, 0, 1, 1}},
{{9462, 29273, 21271, 62428, 23473, 26099, 6645, 62592, 64639, 37747, 56747, 9822, 59581, 42679, 4186, 62586},
 {33846, 38007, 18511, 4322, 25376, 158, 41098, 33748, 24910, 32161, 30994, 37004, 30278, 31690, 31998, 2542},
 {0, 0, 1, 14, 0, 165, 0, 1, 2, 1, 1, 0, 1, 1, 0, 24}},
{{48939, 4523, 3493, 50758, 46104, 8112, 19885, 4883, 45080, 23918, 47805, 12752, 10132, 10604, 54540, 36129},
 {54629, 7056, 46902, 18325, 7654, 247, 13978, 65036, 20967, 16573, 39365, 37972, 63045, 21516, 22307, 8506,},
 {0, 0, 0, 2, 6, 32, 1, 0, 2, 1, 1, 0, 0, 0, 2, 4}},
{{56212, 51702, 37910, 6522, 54279, 48999, 59531, 33563, 57972, 63042, 37127, 31056, 27364, 42620, 57686, 38403},
 {3675, 7012, 57333, 63910, 53628, 64877, 56483, 42417, 10755, 61252, 37407, 59707, 49942, 31959, 13345, 48007},
 {15, 7, 0, 0, 1, 0, 1, 0, 5, 1, 0, 0, 0, 1, 4, 0}},
{{27537, 64320, 56943, 30410, 16177, 55353, 55262, 48266, 8668, 31248, 51401, 32609, 37277, 29102, 2312, 21747},
 {31634, 45190, 63104, 42602, 26589, 14788, 39747, 39686, 1857, 593, 7247, 19258, 50062, 13386, 16861, 49386},
 {0, 1, 0, 0, 0, 3, 1, 1, 4, 52, 7, 1, 0, 2, 0, 0}},
{{49712, 41219, 61014, 35909, 27133, 25755, 12949, 20191, 13717, 40099, 24382, 10529, 30160, 52625, 12020, 47050},
 {62873, 54479, 39094, 58498, 34725, 6364, 46523, 23590, 26798, 37078, 12374, 43989, 25497, 65133, 44474, 37866},
 {0, 0, 1, 0, 0, 4, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1}},
{{36169, 47722, 32035, 17182, 32630, 32087, 32210, 55676, 60219, 23721, 35769, 39618, 39954, 28889, 46314, 14166},
 {47515, 9022, 25084, 64382, 28078, 2010, 44384, 64126, 31183, 44485, 53703, 48852, 62026, 14945, 19042, 33575},
 {0, 5, 1, 0, 1, 15, 0, 0, 1, 0, 0, 0, 0, 1, 2, 0}},
{{37466, 37639, 30437, 7920, 15479, 65458, 36517, 56607, 18817, 47836, 53821, 32029, 38865, 7351, 10376, 45813},
 {20960, 1352, 53336, 12613, 40016, 47064, 58678, 15921, 45803, 11235, 5718, 12548, 11972, 34395, 61681, 17174},
 {1, 27, 0, 0, 0, 1, 0, 3, 0, 4, 9, 2, 3, 0, 0, 2}},
{{45389, 27872, 49777, 26108, 24509, 42015, 34983, 58931, 42951, 60995, 653, 11303, 42167, 50202, 44323, 50495},
 {4934, 60067, 2074, 54332, 13616, 22311, 17075, 20568, 62349, 34899, 37412, 45558, 30971, 50038, 39561, 10468},
 {9, 0, 24, 0, 1, 1, 2, 2, 0, 1, 0, 0, 1, 1, 1, 4}},
{{44012, 2829, 54916, 37487, 12048, 1733, 31151, 36909, 11003, 40006, 42080, 20079, 62703, 50197, 41681, 4506},
 {13496, 44149, 33551, 35633, 21169, 64297, 43180, 1318, 48190, 15569, 55010, 31170, 39762, 2650, 44886, 24443},
 {3, 0, 1, 1, 0, 0, 0, 28, 0, 2, 0, 0, 1, 18, 0, 0}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__udivv16hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
