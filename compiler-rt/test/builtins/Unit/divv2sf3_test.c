// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_divv2sf3

#include <stdio.h>

// Returns: a % b

#define NELTS 2
typedef float elt_t;
typedef elt_t vector_t __attribute__((__vector_size__(NELTS * sizeof(elt_t))));
vector_t __divv2sf3(vector_t a, vector_t b);

#define PRINTT "%.10f"

int test__divv2sf3(vector_t a, vector_t b, vector_t expected_r) {
  vector_t r = __divv2sf3(a, b);
  int res = 0;
  for (int lane = 0; lane < (int)(sizeof(vector_t) / sizeof(elt_t)); ++lane)
    if (r[lane] != expected_r[lane]) {
      printf("error in __divv2sf3 (lane %d): " PRINTT " / " PRINTT " = " PRINTT
             ", expected " PRINTT "\n",
             lane, a[lane], b[lane], r[lane], expected_r[lane]);
      res = 1;
    }
  return res;
}

vector_t tests[][3] = {
    {{8541.40136718750000, 37495.09765625000000},
     {4819.58300781250000, 43524.26171875000000},
     {1.77222824096680, 0.86147576570511}},
    {{28866.94726562500000, 39290.82421875000000},
     {39429.28906250000000, 61962.57421875000000},
     {0.73211938142776, 0.63410574197769}},
    {{43695.93750000000000, 37255.39062500000000},
     {61731.58593750000000, 79648.98437500000000},
     {0.70783758163452, 0.46774470806122}},
    {{36626.68750000000000, 13011.56738281250000},
     {81446.27343750000000, 118488.48437500000000},
     {0.44970366358757, 0.10981293022633}},
    {{42252.20703125000000, 28789.51953125000000},
     {117223.20312500000000, 122638.69531250000000},
     {0.36044234037399, 0.23475070297718}},
    {{22791.61718750000000, 5497.57568359375000},
     {144484.60937500000000, 142173.03125000000000},
     {0.15774425864220, 0.03866820409894}},
    {{28429.42968750000000, 47953.35937500000000},
     {187870.56250000000000, 150332.50000000000000},
     {0.15132455527782, 0.31898197531700}},
    {{13775.59765625000000, 13018.37402343750000},
     {234075.29687500000000, 172128.62500000000000},
     {0.05885113775730, 0.07563166320324}},
    {{39473.10156250000000, 6380.92626953125000},
     {238185.57812500000000, 219160.71875000000000},
     {0.16572414338589, 0.02911528199911}},
    {{1278.91198730468750, 7710.57568359375000},
     {257294.70312500000000, 226897.54687500000000},
     {0.00497061153874, 0.03398263081908}},
    {{26466.67578125000000, 43842.45703125000000},
     {278825.28125000000000, 240092.85937500000000},
     {0.09492208063602, 0.18260625004768}},
    {{15679.82031250000000, 38504.76562500000000},
     {284194.81250000000000, 278644.96875000000000},
     {0.05517278984189, 0.13818575441837}},
    {{35259.83203125000000, 10932.12109375000000},
     {322284.50000000000000, 299230.62500000000000},
     {0.10940591990948, 0.03653409704566}},
    {{32441.45117187500000, 46497.84765625000000},
     {347405.43750000000000, 333602.65625000000000},
     {0.09338210523129, 0.13938093185425}},
    {{21804.64062500000000, 30415.18554687500000},
     {376233.37500000000000, 365233.75000000000000},
     {0.05795509368181, 0.08327594399452}},
    {{23171.33984375000000, 31612.27343750000000},
     {383148.12500000000000, 413271.81250000000000},
     {0.06047619134188, 0.07649268954992}},
    {{7218.81054687500000, 22334.23046875000000},
     {399377.34375000000000, 460901.03125000000000},
     {0.01807516254485, 0.04845775663853}},
    {{17909.21289062500000, 19910.45898437500000},
     {404441.40625000000000, 508655.31250000000000},
     {0.04428135231137, 0.03914332389832}},
    {{49230.89062500000000, 28798.54296875000000},
     {447737.09375000000000, 516149.09375000000000},
     {0.10995490849018, 0.05579500645399}},
    {{45457.63281250000000, 32562.68164062500000},
     {450930.12500000000000, 563899.06250000000000},
     {0.10080859810114, 0.05774558708072}},
    {{48313.23828125000000, 39277.22656250000000},
     {491188.37500000000000, 592461.75000000000000},
     {0.09835989773273, 0.06629496067762}},
    {{14129.38476562500000, 48127.61718750000000},
     {520162.21875000000000, 614304.68750000000000},
     {0.02716341987252, 0.07834486663342}},
    {{18771.83593750000000, 46170.45703125000000},
     {521597.18750000000000, 652747.68750000000000},
     {0.03598914295435, 0.07073247432709}},
    {{36155.37500000000000, 29548.53906250000000},
     {542891.62500000000000, 684854.81250000000000},
     {0.06659777462482, 0.04314569756389}},
    {{37338.20312500000000, 3450.97070312500000},
     {545556.37500000000000, 723570.50000000000000},
     {0.06844059377909, 0.00476936344057}},
    {{35175.24218750000000, 6063.32714843750000},
     {560728.25000000000000, 727295.87500000000000},
     {0.06273135542870, 0.00833680946380}},
    {{34393.05078125000000, 18247.81445312500000},
     {597200.43750000000000, 737025.18750000000000},
     {0.05759046599269, 0.02475873939693}},
    {{7729.66699218750000, 8089.64404296875000},
     {638812.06250000000000, 764572.06250000000000},
     {0.01210006419569, 0.01058061700314}},
    {{15857.16406250000000, 26386.83007812500000},
     {660473.18750000000000, 775256.00000000000000},
     {0.02400879375637, 0.03403627872467}},
    {{36480.25390625000000, 68.49916076660156},
     {689783.43750000000000, 799127.87500000000000},
     {0.05288653075695, 0.00008571739454}},
    {{46992.95312500000000, 38107.92968750000000},
     {696170.12500000000000, 799866.81250000000000},
     {0.06750211119652, 0.04764284566045}},
    {{24999.73632812500000, 42238.62500000000000},
     {738777.56250000000000, 804417.25000000000000},
     {0.03383932635188, 0.05250835418701}},
    {{42887.66796875000000, 39446.76171875000000},
     {767701.37500000000000, 809391.68750000000000},
     {0.05586503818631, 0.04873630777001}},
    {{41408.44140625000000, 37359.87890625000000},
     {813119.93750000000000, 834998.81250000000000},
     {0.05092537775636, 0.04474243521690}},
    {{44228.34375000000000, 48097.41796875000000},
     {841445.50000000000000, 858693.31250000000000},
     {0.05256233736873, 0.05601233616471}},
    {{20877.89453125000000, 32517.31250000000000},
     {885455.56250000000000, 887990.06250000000000},
     {0.02357870340347, 0.03661900386214}},
    {{11125.62890625000000, 49967.36718750000000},
     {893414.56250000000000, 922769.93750000000000},
     {0.01245293021202, 0.05414932221174}},
    {{35076.48046875000000, 49310.33593750000000},
     {925844.43750000000000, 955514.00000000000000},
     {0.03788593411446, 0.05160608515143}},
    {{42210.23828125000000, 34088.54296875000000},
     {974351.87500000000000, 972096.93750000000000},
     {0.04332134872675, 0.03506702184677}},
    {{40004.15234375000000, 7968.24560546875000},
     {1017515.81250000000000, 1002234.75000000000000},
     {0.03931551054120, 0.00795047823340}},
    {{20997.98437500000000, 49067.86328125000000},
     {1060960.62500000000000, 1025436.62500000000000},
     {0.01979148387909, 0.04785070195794}},
    {{12342.19921875000000, 42231.97656250000000},
     {1103122.75000000000000, 1062262.00000000000000},
     {0.01118841860443, 0.03975664824247}},
    {{6609.75048828125000, 23840.28710937500000},
     {1142339.62500000000000, 1087141.62500000000000},
     {0.00578615162522, 0.02192932926118}},
    {{28440.92578125000000, 22203.04296875000000},
     {1144101.00000000000000, 1103734.00000000000000},
     {0.02485875412822, 0.02011629939079}},
    {{21331.51953125000000, 29128.52929687500000},
     {1148504.12500000000000, 1137478.37500000000000},
     {0.01857330650091, 0.02560798451304}},
    {{29371.82617187500000, 11785.41699218750000},
     {1185736.37500000000000, 1185396.12500000000000},
     {0.02477095834911, 0.00994217582047}},
    {{43212.79687500000000, 3721.51513671875000},
     {1212726.87500000000000, 1204536.87500000000000},
     {0.03563275188208, 0.00308958184905}},
    {{92.32707214355469, 35830.72265625000000},
     {1215409.75000000000000, 1205589.12500000000000},
     {0.00007596374053, 0.02972050942481}},
    {{37928.05859375000000, 31448.05468750000000},
     {1261960.50000000000000, 1232986.12500000000000},
     {0.03005486913025, 0.02550560235977}},
    {{20701.71679687500000, 19648.07812500000000},
     {1271839.50000000000000, 1248390.37500000000000},
     {0.01627698913217, 0.01573872938752}},
    {{10462.51660156250000, 30554.58398437500000},
     {1290436.50000000000000, 1256422.87500000000000},
     {0.00810773484409, 0.02431870996952}},
    {{23011.18164062500000, 40149.02734375000000},
     {1299607.87500000000000, 1292319.75000000000000},
     {0.01770624890924, 0.03106741048396}},
    {{23834.34179687500000, 7087.74658203125000},
     {1331290.75000000000000, 1304447.87500000000000},
     {0.01790318265557, 0.00543352216482}},
    {{6207.52978515625000, 43573.97656250000000},
     {1336461.25000000000000, 1342168.25000000000000},
     {0.00464475108311, 0.03246536105871}},
    {{19029.02343750000000, 27836.80664062500000},
     {1340373.12500000000000, 1361037.00000000000000},
     {0.01419681031257, 0.02045264467597}},
    {{31259.22460937500000, 39481.10546875000000},
     {1361441.12500000000000, 1402249.12500000000000},
     {0.02296039462090, 0.02815555781126}},
    {{27595.84960937500000, 36410.05468750000000},
     {1385881.87500000000000, 1415358.37500000000000},
     {0.01991212181747, 0.02572497166693}},
    {{24895.56445312500000, 24478.39453125000000},
     {1410457.00000000000000, 1457837.00000000000000},
     {0.01765070855618, 0.01679090037942}},
    {{45944.92578125000000, 18097.96679687500000},
     {1437746.50000000000000, 1488063.62500000000000},
     {0.03195620700717, 0.01216209214181}},
    {{30482.95117187500000, 22041.02539062500000},
     {1473082.50000000000000, 1498871.12500000000000},
     {0.02069330960512, 0.01470508333296}},
    {{38283.97656250000000, 15319.37011718750000},
     {1512394.75000000000000, 1503360.75000000000000},
     {0.02531348168850, 0.01019008271396}},
    {{44929.80859375000000, 46679.45703125000000},
     {1560763.87500000000000, 1534288.00000000000000},
     {0.02878706343472, 0.03042418137193}},
    {{3345.98217773437500, 5651.56201171875000},
     {1592296.62500000000000, 1537998.75000000000000},
     {0.00210135616362, 0.00367462076247}},
    {{27870.36328125000000, 11710.19921875000000},
     {1622894.75000000000000, 1584726.37500000000000},
     {0.01717324182391, 0.00738941412419}},
    {{28585.13085937500000, 28712.94531250000000},
     {1646116.37500000000000, 1590769.12500000000000},
     {0.01736519485712, 0.01804972440004}},
    {{11809.17968750000000, 49930.39453125000000},
     {1673977.37500000000000, 1633958.12500000000000},
     {0.00705456361175, 0.03055793978274}},
    {{14355.99707031250000, 36497.23046875000000},
     {1715040.25000000000000, 1658394.75000000000000},
     {0.00837064720690, 0.02200756594539}},
    {{29652.38281250000000, 5608.05761718750000},
     {1722955.25000000000000, 1693348.12500000000000},
     {0.01721018739045, 0.00331181613728}},
    {{29741.07031250000000, 44149.66015625000000},
     {1744510.37500000000000, 1703852.00000000000000},
     {0.01704837754369, 0.02591167576611}},
    {{9108.84179687500000, 34374.28125000000000},
     {1755416.62500000000000, 1717075.12500000000000},
     {0.00518899131566, 0.02001908980310}},
    {{11155.01757812500000, 24632.81640625000000},
     {1768807.50000000000000, 1739377.87500000000000},
     {0.00630651880056, 0.01416185405105}},
    {{11812.43066406250000, 14839.44531250000000},
     {1801339.00000000000000, 1776866.12500000000000},
     {0.00655758334324, 0.00835147034377}},
    {{34629.49609375000000, 21244.54882812500000},
     {1839316.75000000000000, 1796785.87500000000000},
     {0.01882736943662, 0.01182363927364}},
    {{18699.58203125000000, 32054.85156250000000},
     {1866007.62500000000000, 1841745.25000000000000},
     {0.01002117153257, 0.01740460656583}},
    {{32769.56250000000000, 46533.37109375000000},
     {1866499.00000000000000, 1850367.62500000000000},
     {0.01755669899285, 0.02514817565680}},
    {{32169.14843750000000, 38301.98437500000000},
     {1900315.75000000000000, 1888892.00000000000000},
     {0.01692831702530, 0.02027748711407}},
    {{37774.05468750000000, 44796.79687500000000},
     {1911206.25000000000000, 1920722.00000000000000},
     {0.01976450905204, 0.02332289516926}},
    {{29859.47070312500000, 31115.93164062500000},
     {1929466.00000000000000, 1924268.00000000000000},
     {0.01547551061958, 0.01617026887834}},
    {{12624.43847656250000, 18055.07812500000000},
     {1953647.50000000000000, 1949453.25000000000000},
     {0.00646198401228, 0.00926161091775}},
    {{14495.54589843750000, 11935.59179687500000},
     {1986771.75000000000000, 1994338.00000000000000},
     {0.00729602994397, 0.00598473846912}},
    {{33572.51171875000000, 2159.09472656250000},
     {2028652.25000000000000, 2022939.37500000000000},
     {0.01654917001724, 0.00106730568223}},
    {{9191.79199218750000, 1322.00524902343750},
     {2052418.12500000000000, 2051097.75000000000000},
     {0.00447851838544, 0.00064453546656}},
    {{8394.86132812500000, 30521.98046875000000},
     {2084523.62500000000000, 2066417.37500000000000},
     {0.00402723252773, 0.01477048173547}},
    {{47839.20312500000000, 38297.66796875000000},
     {2116323.50000000000000, 2069852.37500000000000},
     {0.02260486409068, 0.01850260794163}},
    {{6532.68164062500000, 37856.23046875000000},
     {2140339.50000000000000, 2105587.00000000000000},
     {0.00305217085406, 0.01797894388437}},
    {{5763.27832031250000, 32033.42578125000000},
     {2160257.00000000000000, 2140901.75000000000000},
     {0.00266786688007, 0.01496258564293}},
    {{39198.14843750000000, 35253.28906250000000},
     {2173684.00000000000000, 2179925.50000000000000},
     {0.01803304813802, 0.01617178693414}},
    {{6707.13183593750000, 13846.07714843750000},
     {2177746.75000000000000, 2190588.50000000000000},
     {0.00307984929532, 0.00632071122527}},
    {{9804.50683593750000, 30960.38085937500000},
     {2208083.00000000000000, 2218053.75000000000000},
     {0.00444028014317, 0.01395835448056}},
    {{28376.80859375000000, 6268.17529296875000},
     {2211683.50000000000000, 2262195.75000000000000},
     {0.01283041108400, 0.00277083693072}},
    {{7663.82666015625000, 28288.85742187500000},
     {2227514.50000000000000, 2278935.50000000000000},
     {0.00344052817672, 0.01241318881512}},
    {{10279.61328125000000, 33813.33593750000000},
     {2229501.50000000000000, 2281054.00000000000000},
     {0.00461072288454, 0.01482355780900}},
    {{40798.10156250000000, 3231.53247070312500},
     {2264891.50000000000000, 2301529.75000000000000},
     {0.01801327057183, 0.00140408030711}},
    {{44392.46484375000000, 46983.92187500000000},
     {2265042.50000000000000, 2319068.50000000000000},
     {0.01959895528853, 0.02025982551277}},
    {{46921.39453125000000, 49571.17187500000000},
     {2282978.50000000000000, 2367905.25000000000000},
     {0.02055270969868, 0.02093460969627}},
    {{1317.23291015625000, 17054.44726562500000},
     {2325288.25000000000000, 2389816.00000000000000},
     {0.00056648155442, 0.00713630160317}},
    {{35176.04296875000000, 28530.11718750000000},
     {2330461.50000000000000, 2398859.00000000000000},
     {0.01509402412921, 0.01189320348203}},
    {{12011.16406250000000, 34212.50390625000000},
     {2379716.75000000000000, 2424539.50000000000000},
     {0.00504730828106, 0.01411092840135}},
    {{45044.79296875000000, 23340.92382812500000},
     {2403434.75000000000000, 2444916.00000000000000},
     {0.01874184235930, 0.00954671856016}},
    {{37924.58984375000000, 5751.23095703125000},
     {2410728.00000000000000, 2479872.75000000000000},
     {0.01573159173131, 0.00231916364282}},
    {{13009.65234375000000, 26510.35742187500000},
     {2414043.25000000000000, 2487313.75000000000000},
     {0.00538915442303, 0.01065822783858}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  int r = 0;
  for (i = 0; i < N; ++i)
    r |= test__divv2sf3(tests[i][0], tests[i][1], tests[i][2]);

  return r;
}
