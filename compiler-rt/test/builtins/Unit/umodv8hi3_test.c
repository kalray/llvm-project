// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_umodv8hi3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef short elt;
typedef elt vt __attribute__((__vector_size__(16)));
vt __umodv8hi3(vt a, vt b);

int test__umodv8hi3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __umodv8hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __umodv8hi3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
    {{5597, 24572, 3157, 28522, 18916, 25748, 22681, 12083},
     {28636, 24415, 14616, 11591, 24003, 8527, 12920, 25454},
     {5597, 157, 3157, 5340, 18916, 167, 9761, 12083}},
    {{-32250, 19023, 26603, 8059, -31684, 3769, 27626, 24884},
     {-18270, -9696, -22488, 16938, -32506, 17058, -22337, -25799},
     {-32250, 19023, 26603, 8059, 822, 3769, 27626, 24884}},
    {{-6382, 23204, 29296, -26655, 1660, 8822, -25388, 29954},
     {-926, 19035, -8379, 25585, -22231, -23245, -18819, -535},
     {-6382, 4169, 29296, 13296, 1660, 8822, -25388, 29954}},
    {{16725, 11333, -11279, 26786, 22920, -26243, -8926, -13057},
     {13363, -26569, 10513, -19222, -7046, -2529, -14288, 30946},
     {3362, 11333, 1692, 26786, 22920, -26243, 5362, 21533}},
    {{8092, 25969, 12327, -7537, -30880, -13195, 8680, -12708},
     {-19911, -7697, -26650, -14312, 22744, 18810, -12196, -3298},
     {8092, 25969, 12327, 6775, 11912, 14721, 8680, -12708}},
    {{-25783, -13828, -26827, 25493, 21171, -19276, 27667, 1606},
     {-7610, 22560, -25710, 10881, -19098, -27362, 1759, 17743},
     {-25783, 6588, -26827, 3731, 21171, 8086, 1282, 1606}},
    {{-1314, 8849, -25081, 29102, -21314, 12059, 11224, 4047},
     {14929, -31018, -1809, 17257, -14033, -22061, 29028, -29741},
     {4506, 8849, -25081, 11845, -21314, 12059, 11224, 4047}},
    {{14897, 26141, -10886, 18846, 2592, 12103, 30432, 19691},
     {-19811, -6045, 2376, 17741, 2350, 5619, -8586, -26759},
     {14897, 26141, 2, 1105, 242, 865, 30432, 19691}},
    {{-22534, -13544, 18956, 4364, 27378, 25348, -5340, -29064},
     {9173, 25475, 20938, -32268, 16032, 26928, 20255, -7560},
     {6310, 1042, 18956, 4364, 11346, 25348, 19686, -29064}},
    {{13601, -31749, 24171, 27156, -31203, -7873, -24598, -7606},
     {-28701, -17722, -12810, -21401, -23288, 32149, -16994, 12190},
     {13601, -31749, 24171, 27156, -31203, 25514, -24598, 9170}},
    {{27361, 407, -12894, -23175, -23115, -12346, 3032, -32233},
     {-24370, -2099, 12890, -5097, -4650, -18837, -15840, 23063},
     {27361, 407, 1082, -23175, -23115, 6491, 3032, 10240}
    },
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__umodv8hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
