// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_umodv8hi3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef unsigned short elt;
typedef elt vt __attribute__((__vector_size__(16)));
vt __umodv8hi3(vt a, vt b);

int test__umodv8hi3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __umodv8hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __umodv8hi3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
{{5597, 24572, 3157, 28522, 18916, 25748, 22681, 12083},
 {28636, 24415, 14616, 11591, 24003, 8527, 12920, 25454},
 {5597, 157, 3157, 5340, 18916, 167, 9761, 12083}},
{{33286, 19023, 26603, 8059, 33852, 3769, 27626, 24884},
 {47266, 55840, 43048, 16938, 33030, 17058, 43199, 39737},
 {33286, 19023, 26603, 8059, 822, 3769, 27626, 24884}},
{{59154, 23204, 29296, 38881, 1660, 8822, 40148, 29954},
 {64610, 19035, 57157, 25585, 43305, 42291, 46717, 65001},
 {59154, 4169, 29296, 13296, 1660, 8822, 40148, 29954}},
{{16725, 11333, 54257, 26786, 22920, 39293, 56610, 52479},
 {13363, 38967, 10513, 46314, 58490, 63007, 51248, 30946},
 {3362, 11333, 1692, 26786, 22920, 39293, 5362, 21533}},
{{8092, 25969, 12327, 57999, 34656, 52341, 8680, 52828},
 {45625, 57839, 38886, 51224, 22744, 18810, 53340, 62238},
 {8092, 25969, 12327, 6775, 11912, 14721, 8680, 52828}},
{{39753, 51708, 38709, 25493, 21171, 46260, 27667, 1606},
 {57926, 22560, 39826, 10881, 46438, 38174, 1759, 17743},
 {39753, 6588, 38709, 3731, 21171, 8086, 1282, 1606}},
{{64222, 8849, 40455, 29102, 44222, 12059, 11224, 4047},
 {14929, 34518, 63727, 17257, 51503, 43475, 29028, 35795},
 {4506, 8849, 40455, 11845, 44222, 12059, 11224, 4047}},
{{14897, 26141, 54650, 18846, 2592, 12103, 30432, 19691},
 {45725, 59491, 2376, 17741, 2350, 5619, 56950, 38777},
 {14897, 26141, 2, 1105, 242, 865, 30432, 19691}},
{{43002, 51992, 18956, 4364, 27378, 25348, 60196, 36472},
 {9173, 25475, 20938, 33268, 16032, 26928, 20255, 57976},
 {6310, 1042, 18956, 4364, 11346, 25348, 19686, 36472}},
{{13601, 33787, 24171, 27156, 34333, 57663, 40938, 57930},
 {36835, 47814, 52726, 44135, 42248, 32149, 48542, 12190},
 {13601, 33787, 24171, 27156, 34333, 25514, 40938, 9170}},
{{27361, 407, 52642, 42361, 42421, 53190, 3032, 33303},
 {41166, 63437, 12890, 60439, 60886, 46699, 49696, 23063},
 {27361, 407, 1082, 42361, 42421, 6491, 3032, 10240}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__umodv8hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
