// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_umodv4hi3

#include <stdio.h>

// Returns: a % b

typedef unsigned short v4hu __attribute__((__vector_size__(8)));
v4hu __umodv4hi3(v4hu a, v4hu b);

int test__umodv4hi3(v4hu a, v4hu b, v4hu expected_r) {
  v4hu r = __umodv4hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < 4; ++lane)
    if (r[lane] != expected_r[lane]) {
      printf("error in __umodv4hi3 (lane %d): %X %% %X = %X, expected %X\n",
             lane, a[lane], b[lane], r[lane], expected_r[lane]);
      res = 1;
    }
  return res;
}

v4hu tests[][3] = {
    {{0, 1, 12, 101}, {10, 11, 12, 100}, {0, 1, 0, 1}},
    {{100, 100, 0, 90}, {101, 95, 1, 90}, {100, 5, 0, 0}},
    {{0, 0, 12084, 33279}, {32857, 17641, 39479, 387}, {0, 0, 12084, 384}},
    {{36512, 44172, 38353, 23313},
     {38693, 3623, 49003, 46663},
     {36512, 696, 38353, 23313}},
    {{18531, 696, 38353, 43288},
     {44650, 23195, 49003, 46663},
     {18531, 696, 38353, 43288}},
    {{57581, 37129, 50401, 53688},
     {53296, 40250, 58656, 46663},
     {4285, 37129, 50401, 7025}},
    {{4285, 37129, 60826, 7025},
     {33413, 26550, 31361, 46663},
     {4285, 10579, 29465, 7025}},
    {{41868, 44626, 29465, 30686},
     {33413, 26550, 59385, 53532},
     {8455, 18076, 29465, 30686}},
    {{55132, 18076, 6059, 48130},
     {997, 2442, 64214, 24483},
     {297, 982, 6059, 23647}},
    {{3788, 22371, 53828, 46419},
     {37616, 10328, 3764, 11810},
     {3788, 1715, 1132, 10989}},
    {{34149, 36365, 30922, 53737},
     {64065, 31926, 9818, 50294},
     {34149, 4439, 1468, 3443}},
    {{34149, 4439, 15127, 24490},
     {31514, 19101, 57029, 21582},
     {2635, 4439, 15127, 2908}},
    {{2635, 46176, 15127, 34036},
     {31514, 54197, 14219, 21582},
     {2635, 46176, 908, 12454}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__umodv4hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
