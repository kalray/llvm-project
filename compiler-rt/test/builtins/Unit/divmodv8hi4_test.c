// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_divmodv8hi4

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef short elt;
typedef elt vt __attribute__((__vector_size__(16)));
vt __divmodv8hi4(vt a, vt b, vt *r);

int test__divmodv8hi4(vt a, vt b, vt expected_q, vt expected_rem) {
  const int N = sizeof(vt) / sizeof(elt);
  vt rem;
  vt q = __divmodv8hi4(a, b, &rem);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected_q[lane] || rem[lane] != expected_rem[lane]) {
      printf("error in __divmodv8hi4 (lane %d): %hd divmod %hd = q(%hd), rem(%hd), "
             "expected q(%hd), rem (%hd)\n",
             lane, a[lane], b[lane], q[lane], rem[lane], expected_q[lane],
             expected_rem[lane]);
      res = 1;
    }
  return res;
}

vt tests[][4] = {
    {{-6688, -11103, 6042, 16639, 16427, 8820, 19739, 193},
     {18256, 22087, 13135, 11465, 2918, 25759, 4762, 23138},
     {0, 0, 0, 1, 5, 0, 4, 0},
     {-6688, -11103, 6042, 5174, 1837, 8820, 691, 193}},
    {{23777, -12717, -1688, 9988, 2983, 9786, -2337, -9113},
     {12837, 7113, 12066, 10374, 6160, 17347, 5517, -11016},
     {1, -1, 0, 0, 0, 0, 0, 0},
     {10940, -5604, -1688, 9988, 2983, 9786, -2337, -9113}},
    {{-2586, -4972, 5212, -12328, 22826, 25917, 19120, -13553},
     {29731, 11419, -8198, 21818, 157, -1870, 11674, -5679},
     {0, 0, 0, 0, 145, -13, 1, 2},
     {-2586, -4972, 5212, -12328, 61, 1607, 7446, -2195},
    },
    {{23338, -10939, 21064, 8722, 16704, 20700, 2415, 18245},
     {-841, 5722, 29096, -942, 18370, 5550, 9988, 24236},
     {-27, -1, 0, -9, 0, 3, 0, 0},
     {631, -5217, 21064, 244, 16704, 4050, 2415, 18245}},
    {{15153, 17323, 14894, 21364, 13224, 10801, 3027, 19241},
     {-8450, -11397, 27893, 10767, -32340, 30405, 26020, -28880},
     {-1, -1, 0, 1, 0, 0, 0, 0},
     {6703, 5926, 14894, 10597, 13224, 10801, 3027, 19241}},
    {{-2318, 20867, -5749, 15564, -3480, 17548, 11363, -4282},
     {11137, -2245, 30280, 19295, -25213, 22217, -8653, 20654},
     {0, -9, 0, 0, 0, 0, -1, 0},
     {-2318, 662, -5749, 15564, -3480, 17548, 2710, -4282}},
    {{14551, 21520, 7128, 1426, -3155, 9555, 1923, -5752},
     {10979, 17451, -15958, 6593, -131, 13929, 10258, -3980},
     {1, 1, 0, 0, 24, 0, 0, 1},
     {3572, 4069, 7128, 1426, -11, 9555, 1923, -1772}},
    {{6155, 11722, 8294, 2186, 24203, 7979, 12754, 19616},
     {23641, 28360, 21276, 22990, 329, 29003, 16350, 2968},
     {0, 0, 0, 0, 73, 0, 0, 6},
     {6155, 11722, 8294, 2186, 186, 7979, 12754, 1808}},
    {{9324, 13238, -8621, 4106, -2477, 18902, 17594, -6260},
     {11178, 22406, 3000, 5000, -575, 9446, 15632, 10843},
     {0, 0, -2, 0, 4, 2, 1, 0},
     {9324, 13238, -2621, 4106, -177, 10, 1962, -6260}},
    {{15732, 18361, 1749, 2759, 6231, -2501, 8532, 9538},
     {19400, 9946, 6751, 14910, 2180, 7604, 7550, 740},
     {0, 1, 0, 0, 2, 0, 1, 12},
     {15732, 8415, 1749, 2759, 1871, -2501, 982, 658}},
    {{21293, 18075, 5590, 6348, -4497, 16020, 18802, 19726},
     {7609, 12444, -4970, 4240, 16007, -6488, 841, -173},
     {2, 1, -1, 1, 0, -2, 22, -114},
     {6075, 5631, 620, 2108, -4497, 3044, 300, 4}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__divmodv8hi4(tests[i][0], tests[i][1], tests[i][2], tests[i][3]))
      return 1;

  return 0;
}
