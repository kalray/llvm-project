// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_divv8hi3

#include <stdio.h>

// Returns: a / b, if (r) r = a % b

typedef short elt;
typedef elt vt __attribute__((__vector_size__(16)));
vt __divv8hi3(vt a, vt b);

int test__divv8hi3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt q = __divv8hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __divv8hi3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
    {{-6688, -11103, 6042, 16639, 16427, 8820, 19739, 193},
     {18256, 22087, 13135, 11465, 2918, 25759, 4762, 23138},
     {0, 0, 0, 1, 5, 0, 4, 0}},
    {{23777, -12717, -1688, 9988, 2983, 9786, -2337, -9113},
     {-27755, -25233, 19159, 16665, 7241, -31250, 9588, 11929},
     {0, 0, 0, 0, 0, 0, 0, 0}},
    {{-2587, -4971, 5212, -12328, 22826, 25917, 19120, -13553},
     {-8964, -8210, 12649, 28495, 4415, 22630, 23599, 15363},
     {0, 0, 0, 0, 5, 1, 0, 0}},
    {{23338, -10939, 21064, 8722, 16564, 20714, 2414, 18243},
     {-7219, 2484, -29003, -25655, 22724, 26573, 26141, -23742},
     {-3, -4, 0, 0, 0, 0, 0, 0}},
    {{15177, 17320, 14894, 21373, 13224, 10798, 3027, 19241},
     {-16300, -3696, -22174, -15132, -26320, -12608, -15790, -5331},
     {0, -4, 0, -1, 0, 0, 0, -3}},
    {{-2317, 20864, -5749, 15562, -3480, 17548, 11363, -4285},
     {-11866, -11867, -6788, -6434, 779, -1192, -27470, -3918},
     {0, -1, 0, -2, -4, -14, 0, 1}},
    {{14551, 21528, 7128, 1424, -3159, 9541, 1924, -5751},
     {1431, 4922, -16997, -15405, 4128, -4811, -19922, -3616},
     {10, 4, 0, 0, 0, -1, 0, 1}},
    {{6164, 11725, 8294, 2186, 24179, 7978, 12754, 19616},
     {21500, 29213, -2849, 6159, 4468, 14637, -5495, 1124},
     {0, 0, -2, 0, 5, 0, -2, 17}},
    {{9324, 13238, -8623, 4106, -2545, 18902, 17592, -6249},
     {26523, -25639, -8143, 8973, 3707, 16104, -2617, 10159},
     {0, 0, 1, 0, 0, 1, -6, 0}},
    {{15732, 18361, 1752, 2759, 6227, -2502, 8525, 9538},
     {-28937, -28931, 1229, 19777, 6064, 23698, 2971, 17159},
     {0, 0, 1, 0, 1, 0, 2, 0}},
    {{21293, 18074, 5591, 6348, -4498, 16020, 18803, 19714},
     {28476, -24902, -5490, 21258, 20200, 19711, 2830, 16328},
     {0, 0, -1, 0, 0, 0, 6, 1}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__divv8hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
