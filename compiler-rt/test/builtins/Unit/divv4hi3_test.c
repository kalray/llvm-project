// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_divv4hi3

#include <stdio.h>

// Returns: a % b

typedef short v4hi __attribute__((__vector_size__(8)));
v4hi __divv4hi3(v4hi a, v4hi b);

int test__divv4hi3(v4hi a, v4hi b, v4hi expected_r) {
  v4hi r = __divv4hi3(a, b);
  int res = 0;
  for (int lane = 0; lane < 4; ++lane)
    if (r[lane] != expected_r[lane]) {
      printf("error in __divv4hi3 (lane %d): %X / %X = %X, expected %X\n", lane,
             a[lane], b[lane], r[lane], expected_r[lane]);
      res = 1;
    }
  return res;
}

v4hi tests[][3] = {
    {{1, -1, 12, -101}, {10, 11, -11, -100}, {0, 0, -1, 1}},
    {{1011, -9594, 0, -90}, {101, 95, -9999, -91}, {10, -100, 0, 0}},
    {{-6688, -11103, 6042, 16639}, {16428, 8821, 19740, 194}, {0, -1, 0, 85}},
    {{18255, 22085, 13134, 11549}, {19345, -30957, 24501, 23331}, {0, 0, 0, 0}},
    {{23777, -12717, -1688, 9987}, {22323, -21171, 22160, 14218}, {1, 0, 0, 0}},
    {{19526, 18216, 6024, 5200}, {26646, -12644, 26986, 3009}, {0, -1, 0, 1}},
    {{-2587, -4972, 5212, -12327},
     {-16064, 13273, -19430, -10544},
     {0, 0, 0, 1}},
    {{18791, 17023, -6510, 11831},
     {-18890, 1617, -5419, -7110},
     {0, 10, 1, -1}},
    {{23338, -10929, 21065, 8721},
     {-2331, 22330, -3005, 11133},
     {-10, 0, -7, 0}},
    {{1735, 10694, 23877, 11386}, {15978, 26273, -463, -27972}, {0, 0, -51, 0}},
    {{15180, 17324, 14843, 21373}, {29202, -28465, 2564, -8731}, {0, 0, 5, -2}},
    {{-9081, -6180, 6834, 10521}, {-19842, -2110, 26169, 9680}, {0, 2, 0, 1}},
    {{-2317, 20870, -5749, 15564}, {-23322, 15438, -28004, 5398}, {0, 1, 0, 2}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__divv4hi3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
