// RUN: %clang_builtins %s %librt -o %t && %run %t
// REQUIRES: librt_has_umodv8si3

#include <stdio.h>

// Returns: a / b

typedef unsigned elt;
typedef elt vt __attribute__((__vector_size__(32)));
vt __umodv8si3(vt a, vt b, vt *r);

int test__umodv8si3(vt a, vt b, vt expected) {
  const int N = sizeof(vt) / sizeof(elt);
  vt rem;
  vt q = __umodv8si3(a, b, &rem);
  int res = 0;
  for (int lane = 0; lane < N; ++lane)
    if (q[lane] != expected[lane]) {
      printf("error in __umodv8hi3 (lane %d): %X / %X = %X, "
             "expected %X\n",
             lane, a[lane], b[lane], q[lane], expected[lane]);
      res = 1;
    }
  return res;
}

vt tests[][3] = {
{{733700828, 3220804480, 413913109, 3738619681, 2479499680, 3374982117, 2972951250, 1583839068},
 {3753389430, 3200159080, 1915752592, 1519251064, 3146147863, 1117644985, 1693478868, 3336287436},
 {733700828, 20645400, 413913109, 700117553, 2479499680, 22047162, 1279472382, 1583839068}},
{{68131811, 2493636889, 3487127973, 1056618075, 142286403, 494265133, 3621208912, 3261825111},
 {1900477931, 3024350818, 1347610436, 2220144673, 34482397, 2235887372, 1367468265, 913593609},
 {68131811, 2493636889, 791907101, 1056618075, 4356815, 494265133, 886272382, 521044284}},
{{3458840409, 3041747802, 1144977834, 801677475, 114200286, 1156596039, 2527733399, 1185633348},
 {4173947649, 2495419113, 3197072480, 3353613284, 1381360514, 1248438680, 1828708595, 4225194878},
 {3458840409, 546328689, 1144977834, 801677475, 114200286, 1156596039, 699024804, 1185633348}},
{{2192664975, 1485378872, 121890822, 2569971540, 2900890270, 855760443, 2856896111, 4138168583},
 {1751976712, 813084322, 1378405659, 1775735545, 3371758514, 3963905078, 2422680807, 4056666450},
 {440688263, 672294550, 121890822, 794235995, 2900890270, 855760443, 434215304, 81502133}},
{{1060774170, 2590783731, 1515970461, 590586157, 144311155, 2566051735, 869216215, 4183564131},
 {1685907004, 3286856984, 802509536, 2419447596, 2981562582, 2466046007, 2696961089, 3863390286},
 {1060774170, 2590783731, 713460925, 590586157, 144311155, 100005728, 869216215, 320173845}},
{{915873844, 1669699583, 4171617484, 3044102028, 1358007580, 4234131015, 3358051231, 2196467360},
 {3298393094, 2957895169, 925772434, 1426708758, 1792315221, 709272740, 231171137, 2326406427},
 {915873844, 1669699583, 468527748, 190684512, 1358007580, 687767315, 121655313, 2196467360}},
{{4123195342, 1966131997, 697427809, 3516336295, 84564725, 1208602758, 1424906925, 2516476153},
 {1957761084, 230402428, 4058710982, 2262449765, 2456283603, 1404165761, 3805584172, 397695364},
 {207673174, 122912573, 697427809, 1253886530, 84564725, 1208602758, 1424906925, 130303969}},
{{1569792117, 2389523030, 2558101939, 2171628543, 3218192697, 1214483867, 3942636061, 2180884539},
 {1699453025, 3503848528, 312356872, 2325921814, 308771439, 737464584, 3170567053, 788573876},
 {1569792117, 2389523030, 59246963, 2171628543, 130478307, 477019283, 772069008, 603736787}},
{{958844521, 1483002399, 2543783288, 2598930990, 3687431656, 3686204089, 378527929, 2803371746},
 {1203667174, 3340413997, 2745502231, 66298038, 2102164487, 3530675695, 2656036724, 3305144183},
 {958844521, 1483002399, 2543783288, 13307508, 1585267169, 155528394, 378527929, 2803371746}},
{{1914526737, 1480196181, 3227454019, 3000875460, 303345500, 96282123, 3164233382, 1321095451},
 {534528615, 1973625838, 2617290025, 1490760357, 1243523956, 4215139748, 2068825013, 1598997114},
 {310940892, 1480196181, 610163994, 19354746, 303345500, 96282123, 1095408369, 1321095451}},
{{2114650596, 1400125439, 47080402, 2012378763, 1363530653, 3723977034, 422140944, 189399795},
 {1102300911, 4021487572, 1691024424, 3627904595, 3686580431, 1827397517, 2220131114, 3024274573},
 {1012349685, 1400125439, 47080402, 2012378763, 1363530653, 69182000, 422140944, 189399795}},
};

int main() {
  const unsigned N = sizeof(tests) / sizeof(tests[0]);
  unsigned i;
  for (i = 0; i < N; ++i)
    if (test__umodv8si3(tests[i][0], tests[i][1], tests[i][2]))
      return 1;

  return 0;
}
