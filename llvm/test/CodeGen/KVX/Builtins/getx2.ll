; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -O3 -mcpu=kv3-1 -o - %s | FileCheck %s
; RUN: llc -O3 -mcpu=kv3-2 -o - %s | FileCheck %s
; RUN: clang -march=kv3-1 -c -o /dev/null %s
; RUN: clang -march=kv3-2 -c -o /dev/null %s

target triple = "kvx-kalray-cos"

define i64 @test() {
; CHECK-LABEL: test:
; CHECK:       # %bb.0:
; CHECK-NEXT:    get $r0 = $pm0
; CHECK-NEXT:    ;; # (end cycle 0)
; CHECK-NEXT:    get $r1 = $pm0
; CHECK-NEXT:    ;; # (end cycle 1)
; CHECK-NEXT:    sbfd $r0 = $r0, $r1
; CHECK-NEXT:    ret
; CHECK-NEXT:    ;; # (end cycle 2)
  %1 = tail call i64 @llvm.read_volatile_register.i64(metadata !3)
  %2 = tail call i64 @llvm.read_volatile_register.i64(metadata !3)
  %3 = sub i64 %2, %1
  ret i64 %3
}

declare i64 @llvm.read_volatile_register.i64(metadata)

!3 = !{!"$pm0"}
